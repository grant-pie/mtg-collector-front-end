import{K as _,g as ee,i as V,h as C,c as n,o as i,a as t,j as b,F as A,t as v,r as R,s as te,z as U,f as ae,k as m,L as j,v as f,C as re,y as k,x as I,D as F,u as g,b as le}from"./ox6ecJFa.js";import{u as O}from"./EqvFJpHS.js";const se=_("/images/back.jpg"),oe={class:"bg-white shadow rounded p-4 flex justify-between"},de={class:"font-bold"},ne={class:"text-sm text-gray-600"},ie={class:"mt-2"},ue={key:0,src:se,alt:"Card Back",class:"w-40"},ce=["src","alt"],ge={key:2,class:"text-sm"},me={key:0},ve={key:1},ye={key:2},fe={key:3},be={key:3,class:"text-sm"},pe={class:"mt-2 text-sm"},xe={key:0},we={key:1,class:"italic text-gray-500"},ke={key:2,class:"text-xs text-purple-600 mt-1"},Ce={key:0},Ae=["onClick"],Pe={__name:"CardItem",props:{card:{type:Object,required:!0},userId:{type:String,required:!1},actions:{type:Array,required:!1}},emits:["onClickAction","cardRevealed","cardUpdateWillingToTrade"],setup(o,{emit:$}){const s=O(),S=ee(),u=V(!1),x=C(()=>S.isAdmin),y=o,P=C(()=>S.userId),d=$,N=C(()=>new Date(y.card.createdAt).toISOString().split("T")[0]);async function M(){if(!u.value)try{u.value=!0,await s.revealCard(y.card.id,y.userId||y.card.userId),d("cardRevealed",y.card)}catch(c){console.error("Failed to reveal card:",c)}finally{u.value=!1}}async function r(){if(!u.value)try{u.value=!0,await s.setWillingToTrade(y.card.id,y.userId||y.card.userId,y.card.willingToTrade),d("cardUpdateWillingToTrade",y.card)}catch(c){console.error("Failed to set willing to trade:",c)}finally{u.value=!1}}return(c,p)=>(i(),n("div",oe,[t("div",null,[o.card.revealed||x.value?(i(),n(A,{key:0},[t("h3",de,v(o.card.cardDetails.name),1),t("p",ne,v(o.card.cardDetails.type),1)],64)):(i(),n(A,{key:1},[p[0]||(p[0]=t("h3",{class:"font-bold"},"Mystery Card",-1)),p[1]||(p[1]=t("p",{class:"text-sm text-gray-600"},"Unknown Type",-1))],64)),t("div",ie,[!o.card.revealed&&!x.value?(i(),n("img",ue)):(i(),n("img",{key:1,src:o.card.cardDetails.imageUrl||`https://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=${o.card.cardDetails.multiverseId}&type=card`,alt:o.card.cardDetails.name,class:"w-40"},null,8,ce)),o.card.revealed||x.value?(i(),n("div",ge,[o.card.cardDetails.manaCost?(i(),n("p",me,"Mana Cost: "+v(o.card.cardDetails.manaCost),1)):b("",!0),o.card.cardDetails.rarity?(i(),n("p",ve,"Rarity: "+v(o.card.cardDetails.rarity),1)):b("",!0),t("p",null,"Willing to Trade: "+v(o.card.willingToTrade),1),o.card.createdAt?(i(),n("p",ye,"Received: "+v(N.value),1)):b("",!0),x.value?(i(),n("p",fe,"Revealed: "+v(o.card.revealed),1)):b("",!0)])):b("",!0),!o.card.revealed&&!x.value&&o.card.createdAt?(i(),n("div",be,[t("p",null,"Received: "+v(N.value),1)])):b("",!0)]),t("div",pe,[(o.card.revealed||x.value)&&o.card.cardDetails.text?(i(),n("p",xe,v(o.card.cardDetails.text),1)):(i(),n("p",we,'This card is face down. Click "Reveal" to see its contents.')),x.value&&!o.card.revealed?(i(),n("p",ke," Admin view: You can see this card's details before it's revealed. ")):b("",!0)]),!o.card.revealed&&P.value===o.userId?(i(),n("button",{key:2,onClick:M,class:"mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm"}," Reveal ")):b("",!0),o.card.revealed&&P.value===o.userId?(i(),n("button",{key:3,onClick:r,class:"mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm"},v(o.card.willingToTrade?"Unwilling to Trade":"Willing To Trade"),1)):b("",!0)]),o.actions?(i(),n("div",Ce,[(i(!0),n(A,null,R(o.actions,T=>(i(),n("button",{key:T,onClick:L=>c.$emit("onClickAction",{action:T,card:o.card}),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded text-xs"},v(T),9,Ae))),128))])):b("",!0)]))}},Te={class:"mb-6 bg-white p-4 rounded-lg shadow"},he={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ue={class:"flex space-x-2 mt-1"},Ie=["value"],Se={class:"grid grid-cols-2 gap-2"},Ne={class:"flex space-x-2"},De={key:0,class:"text-center py-10"},Ve={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"},Re={key:2},$e={class:"mb-4 flex justify-between items-center"},Me={class:"text-sm text-gray-600"},Be={key:0,class:"text-center py-10"},We={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ee={key:0,class:"absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center"},je={key:2,class:"mt-6 flex justify-center"},Le={class:"flex items-center space-x-2"},qe=["disabled"],Fe=["disabled"],Oe={class:"flex space-x-1"},ze=["onClick"],Ge=["disabled"],He=["disabled"],Ke={class:"mt-4 flex justify-end"},Ye={class:"flex items-center space-x-2"},Qe={__name:"UserCardsList",props:{userName:{type:String,required:!1},userId:{type:String,required:!1},cardActions:{type:Array,required:!1},excludeCards:{type:Array,required:!1}},emits:["onClickAction"],setup(o,{emit:$}){const s=o,S=$,u=O(),{userCards:x,loading:y,error:P,pagination:d}=te(u),N=C(()=>x.value),M=l=>s.excludeCards?s.excludeCards.map(a=>a.id).includes(l.id):!1,r=V({name:"",type:"",rarity:"",set:"",manaCost:"",convertedManaCost:"",minPower:"",minToughness:"",text:"",createdAt:"",willingToTrade:"",createdAtStart:"",createdAtEnd:"",orderBy:"",orderDirection:"ASC",page:1,limit:10}),c=V(10),p=V([]),T=C(()=>s.userName),L=C(()=>{const l=d.value.totalPages,e=d.value.currentPage,a=5;if(l<=a)return Array.from({length:l},(X,E)=>E+1);let w=Math.max(1,e-Math.floor(a/2)),D=w+a-1;return D>l&&(D=l,w=Math.max(1,D-a+1)),Array.from({length:D-w+1},(X,E)=>w+E)});U(T,async()=>{s.userName&&(r.value.page=1,await u.fetchCardsByUsername(s.userName,{page:r.value.page,limit:c.value}))}),U(p,l=>{r.value.colors=l.length>0?l:void 0}),U(()=>[r.value.createdAtStart,r.value.createdAtEnd],([l,e])=>{(l||e)&&(r.value.createdAt="")}),U(()=>r.value.createdAt,l=>{l&&(r.value.createdAtStart="",r.value.createdAtEnd="")});const B=l=>l||"";ae(async()=>{s.userId&&await u.fetchUserCards(s.userId,1,c.value),s.userName&&await u.fetchCardsByUsername(s.userName,{page:1,limit:c.value})}),U(()=>s.userId,async l=>{l&&(q(),await u.fetchUserCards(l,1,c.value))});const W=async l=>{const e={...h(),page:l,limit:c.value};s.userId?await u.searchUserCards(s.userId,e):s.userName&&await u.fetchCardsByUsername(s.userName,e)},z=()=>{d.value.currentPage!==1&&W(1)},G=()=>{d.value.currentPage!==d.value.totalPages&&W(d.value.totalPages)},H=async()=>{if(d.value.currentPage<d.value.totalPages){const l=d.value.currentPage+1,e={...h(),page:l,limit:c.value};s.userId?await u.searchUserCards(s.userId,e):s.userName&&await u.fetchCardsByUsername(s.userName,e)}},K=async()=>{if(d.value.currentPage>1){const l=d.value.currentPage-1,e={...h(),page:l,limit:c.value};s.userId?await u.searchUserCards(s.userId,e):s.userName&&await u.fetchCardsByUsername(s.userName,e)}},Y=async()=>{const l=Number(c.value);r.value.limit=l,r.value.page=1;const e=h();s.userId?await u.searchUserCards(s.userId,e):s.userName&&await u.fetchCardsByUsername(s.userName,e)},h=()=>{const l={};for(const[e,a]of Object.entries(r.value))a!==""&&a!==void 0&&a!==null&&(l[e]=a);return p.value.length>0&&(l.colors=p.value),l.createdAt&&(l.createdAt=B(l.createdAt)),l.createdAtStart&&(l.createdAtStart=B(l.createdAtStart)),l.createdAtEnd&&(l.createdAtEnd=B(l.createdAtEnd)),l.limit=c.value,l.page=r.value.page||1,l},Z=async()=>{const l=h();l.limit=c.value,s.userId?await u.searchUserCards(s.userId,l):s.userName&&await u.fetchCardsByUsername(s.userName,l)},J=async()=>{r.value.page=1,await Z()},q=async()=>{r.value={name:"",type:"",rarity:"",set:"",manaCost:"",convertedManaCost:"",minPower:"",minToughness:"",text:"",artist:"",willingToTrade:"",createdAt:"",createdAtStart:"",createdAtEnd:"",orderBy:"",orderDirection:"ASC",page:1,limit:c.value},p.value=[],s.userId?await u.fetchUserCards(s.userId,1,c.value):s.userName&&await u.fetchCardsByUsername(s.userName,{page:1,limit:c.value})},Q=l=>{S("onClickAction",l)};return(l,e)=>(i(),n("div",null,[t("div",Te,[e[44]||(e[44]=t("h3",{class:"text-lg font-medium mb-4"},"Search Cards",-1)),t("div",he,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700"},"Willing to Trade",-1)),m(t("input",{type:"radio",value:"true","onUpdate:modelValue":e[0]||(e[0]=a=>r.value.willingToTrade=a),name:"willing_to_trade",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[j,r.value.willingToTrade]]),e[22]||(e[22]=t("label",{for:"true",class:"ml-1"},"Willing",-1)),m(t("input",{type:"radio",value:"false","onUpdate:modelValue":e[1]||(e[1]=a=>r.value.willingToTrade=a),name:"willing_to_trade",class:"ml-2 rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[j,r.value.willingToTrade]]),e[23]||(e[23]=t("label",{for:"false",class:"ml-1"},"Unwilling",-1)),m(t("input",{type:"radio",value:"","onUpdate:modelValue":e[2]||(e[2]=a=>r.value.willingToTrade=a),name:"willing_to_trade",class:"ml-2 rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[j,r.value.willingToTrade]]),e[24]||(e[24]=t("label",{for:"",class:"ml-1"},"Any",-1))]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700"},"Card Name",-1)),m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.name=a),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.name]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700"},"Card Type",-1)),m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.type=a),type:"text",placeholder:"Creature, Instant, etc.",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.type]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"Colors",-1)),t("div",Ue,[(i(),n(A,null,R(["W","U","B","R","G"],a=>t("label",{key:a,class:"inline-flex items-center"},[m(t("input",{type:"checkbox",value:a,"onUpdate:modelValue":e[5]||(e[5]=w=>p.value=w),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,8,Ie),[[re,p.value]]),t("span",{class:k(["ml-1",{"text-yellow-500 font-bold":a==="W","text-blue-500 font-bold":a==="U","text-gray-800 font-bold":a==="B","text-red-500 font-bold":a==="R","text-green-500 font-bold":a==="G"}])},v(a),3)])),64))])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700"},"Revealed",-1)),m(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.revealed=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[28]||(e[28]=[t("option",{value:""},"Any",-1),t("option",{value:"true"},"Revealed",-1),t("option",{value:"false"},"Not Revealed",-1)]),512),[[I,r.value.revealed]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700"},"Rarity",-1)),m(t("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>r.value.rarity=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[30]||(e[30]=[F('<option value="">Any</option><option value="common">Common</option><option value="uncommon">Uncommon</option><option value="rare">Rare</option><option value="mythic">Mythic</option>',5)]),512),[[I,r.value.rarity]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700"},"Set",-1)),m(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>r.value.set=a),type:"text",placeholder:"e.g. ZNR",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.set]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700"},"Mana Cost",-1)),m(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>r.value.manaCost=a),type:"text",placeholder:"e.g. {2}{W}{W}",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.manaCost]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700"},"CMC",-1)),m(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>r.value.convertedManaCost=a),type:"number",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.convertedManaCost]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700"},"Min Power",-1)),m(t("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>r.value.minPower=a),type:"number",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.minPower]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700"},"Min Toughness",-1)),m(t("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>r.value.minToughness=a),type:"number",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.minToughness]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700"},"Card Text",-1)),m(t("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>r.value.text=a),type:"text",placeholder:"Search card text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.text]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700"},"Artist",-1)),m(t("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>r.value.artist=a),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.artist]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700"},"Received On",-1)),m(t("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>r.value.createdAt=a),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[f,r.value.createdAt]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700"},"Received Between",-1)),t("div",Se,[t("div",null,[m(t("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>r.value.createdAtStart=a),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"From"},null,512),[[f,r.value.createdAtStart]])]),t("div",null,[m(t("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>r.value.createdAtEnd=a),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"To"},null,512),[[f,r.value.createdAtEnd]])])])]),t("div",null,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium text-gray-700"},"Sort By",-1)),t("div",Ne,[m(t("select",{"onUpdate:modelValue":e[18]||(e[18]=a=>r.value.orderBy=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[41]||(e[41]=[F('<option value="">Default</option><option value="name">Name</option><option value="convertedManaCost">CMC</option><option value="rarity">Rarity</option><option value="set">Set</option><option value="createdAt">Received Date</option>',6)]),512),[[I,r.value.orderBy]]),m(t("select",{"onUpdate:modelValue":e[19]||(e[19]=a=>r.value.orderDirection=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[42]||(e[42]=[t("option",{value:"ASC"},"Ascending",-1),t("option",{value:"DESC"},"Descending",-1)]),512),[[I,r.value.orderDirection]])])])]),t("div",{class:"mt-4 flex justify-end space-x-3"},[t("button",{onClick:q,class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300"}," Reset "),t("button",{onClick:J,class:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700"}," Search ")])]),g(y)?(i(),n("div",De,e[45]||(e[45]=[t("p",null,"Loading cards...",-1)]))):g(P)?(i(),n("div",Ve,v(g(P)),1)):(i(),n("div",Re,[t("div",$e,[e[46]||(e[46]=t("h3",{class:"text-lg font-medium"},"Card List",-1)),t("p",Me," Showing "+v(g(d).itemCount)+" of "+v(g(d).totalItems)+" cards (Page "+v(g(d).currentPage)+" of "+v(g(d).totalPages)+") ",1)]),N.value.length===0?(i(),n("div",Be,e[47]||(e[47]=[t("p",null,"No cards found matching your criteria.",-1)]))):(i(),n("div",We,[(i(!0),n(A,null,R(g(x),a=>(i(),n("div",{key:a.id,class:"relative"},[le(Pe,{card:a,userId:o.userId,actions:o.cardActions,onOnClickAction:Q},null,8,["card","userId","actions"]),M(a)?(i(),n("div",Ee,e[48]||(e[48]=[t("p",{class:"text-lg font-bold text-gray-800"},"Selected",-1)]))):b("",!0)]))),128))])),g(d).totalPages>1?(i(),n("div",je,[t("nav",Le,[t("button",{onClick:z,disabled:g(d).currentPage===1,class:k(["px-3 py-1 rounded border",g(d).currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white hover:bg-gray-50"])}," « ",10,qe),t("button",{onClick:K,disabled:g(d).currentPage===1,class:k(["px-3 py-1 rounded border",g(d).currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white hover:bg-gray-50"])}," ‹ ",10,Fe),t("div",Oe,[(i(!0),n(A,null,R(L.value,a=>(i(),n("button",{key:a,onClick:w=>W(a),class:k(["px-3 py-1 rounded border",a===g(d).currentPage?"bg-indigo-600 text-white":"bg-white hover:bg-gray-50"])},v(a),11,ze))),128))]),t("button",{onClick:H,disabled:g(d).currentPage===g(d).totalPages,class:k(["px-3 py-1 rounded border",g(d).currentPage===g(d).totalPages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white hover:bg-gray-50"])}," › ",10,Ge),t("button",{onClick:G,disabled:g(d).currentPage===g(d).totalPages,class:k(["px-3 py-1 rounded border",g(d).currentPage===g(d).totalPages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white hover:bg-gray-50"])}," » ",10,He)])])):b("",!0),t("div",Ke,[t("div",Ye,[e[50]||(e[50]=t("label",{class:"text-sm text-gray-600"},"Items per page:",-1)),m(t("select",{"onUpdate:modelValue":e[20]||(e[20]=a=>c.value=a),onChange:Y,class:"rounded border-gray-300 text-sm focus:border-indigo-500 focus:ring-indigo-500"},e[49]||(e[49]=[t("option",{value:"10"},"10",-1),t("option",{value:"20"},"20",-1),t("option",{value:"50"},"50",-1)]),544),[[I,c.value]])])])]))]))}};export{Qe as _};
