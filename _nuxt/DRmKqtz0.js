import{_ as M}from"./D5Mea2Pt.js";import{H as T,l as g,z as A,g as E,n as L,j as N,O as S,c,o as i,a as r,p as d,k as n,t as y,F as U,r as z,D as F,y as R,_ as q,B as P,s as H,b as B,w as _,d as p,G as k,P as V}from"./Za88pMt1.js";import{_ as G}from"./CQ7E7Op1.js";const O=T("notification",{state:()=>({notifications:[],unreadCount:0,loading:!1,error:null,markAsReadLoading:!1,markAsReadError:null}),getters:{unreadNotifications(){return this.notifications.filter(o=>!o.read)},readNotifications(){return this.notifications.filter(o=>o.read)},sortedNotifications(){return[...this.notifications].sort((o,t)=>o.read!==t.read?o.read?1:-1:new Date(t.createdAt).getTime()-new Date(o.createdAt).getTime())}},actions:{async fetchNotifications(){var t;const o=g();if(!o.token){this.error="Authentication required";return}this.loading=!0,this.error=null;try{const e=A(),s=await $fetch(`${e.public.apiBaseUrl}/notifications/my`,{headers:{Authorization:`Bearer ${o.token}`}});this.notifications=s}catch(e){console.error("Error fetching notifications:",e),this.error="Failed to load notifications",((t=e==null?void 0:e.response)==null?void 0:t.status)===401&&o.logout()}finally{this.loading=!1}},async fetchUnreadCount(){var t;const o=g();if(o.token)try{const e=A(),s=await $fetch(`${e.public.apiBaseUrl}/notifications/my/count`,{headers:{Authorization:`Bearer ${o.token}`}});this.unreadCount=s.count}catch(e){console.error("Error fetching unread count:",e),((t=e==null?void 0:e.response)==null?void 0:t.status)===401&&o.logout()}},async markAsRead(o){const t=g();if(!t.token)return this.markAsReadError="Authentication required",!1;this.markAsReadLoading=!0,this.markAsReadError=null;try{const e=A();await $fetch(`${e.public.apiBaseUrl}/notifications/${o}/read`,{method:"PATCH",headers:{Authorization:`Bearer ${t.token}`}});const s=this.notifications.find(u=>u.id===o);return s&&(s.read=!0),this.unreadCount=Math.max(0,this.unreadCount-1),!0}catch(e){return console.error("Error marking notification as read:",e),this.markAsReadError="Failed to mark notification as read",!1}finally{this.markAsReadLoading=!1}},async markAllAsRead(){const o=g();if(!o.token)return this.markAsReadError="Authentication required",!1;this.markAsReadLoading=!0,this.markAsReadError=null;try{const t=A();return await $fetch(`${t.public.apiBaseUrl}/notifications/my/read-all`,{method:"PATCH",headers:{Authorization:`Bearer ${o.token}`}}),this.notifications.forEach(e=>{e.read=!0}),this.unreadCount=0,!0}catch(t){return console.error("Error marking all notifications as read:",t),this.markAsReadError="Failed to mark all notifications as read",!1}finally{this.markAsReadLoading=!1}},async deleteNotification(o){const t=g();if(!t.token)return this.error="Authentication required",!1;try{const e=A();await $fetch(`${e.public.apiBaseUrl}/notifications/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.token}`}});const s=this.notifications.findIndex(u=>u.id===o);if(s!==-1){const u=!this.notifications[s].read;this.notifications.splice(s,1),u&&(this.unreadCount=Math.max(0,this.unreadCount-1))}return!0}catch(e){return console.error("Error deleting notification:",e),this.error="Failed to delete notification",!1}},addNotification(o){this.notifications.unshift(o),o.read||this.unreadCount++,this.notifications=[...this.notifications].sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},clearNotifications(){this.notifications=[],this.unreadCount=0,this.error=null}}}),j={class:"notification-bell"},I={key:0,class:"badge"},J={key:0,class:"notification-dropdown"},Y={class:"notification-header"},K=["disabled"],Q={key:0,class:"notification-loading"},W={key:1,class:"notification-error"},X={key:2,class:"no-notifications"},Z={key:3,class:"notification-list"},tt=["onClick"],et={class:"notification-title"},ot={class:"notification-message"},it={class:"notification-time"},st={class:"notification-actions"},at=["onClick"],nt=["onClick"],rt=E({__name:"NotificationBell",setup(o){const t=O(),e=L(!1);N(async()=>{await t.fetchNotifications(),await t.fetchUnreadCount()});const s=l=>{const h=document.querySelector(".notification-bell");h&&!h.contains(l.target)&&(e.value=!1)};N(()=>{document.addEventListener("click",s)}),S(()=>{document.removeEventListener("click",s)});const u=()=>{e.value=!e.value,e.value&&t.fetchNotifications()},x=l=>{const h=new Date(l),b=new Date().getTime()-h.getTime(),v=Math.floor(b/6e4),w=Math.floor(v/60),$=Math.floor(w/24);return v<60?v===0?"Just now":`${v}m ago`:w<24?`${w}h ago`:$<7?`${$}d ago`:h.toLocaleDateString()},C=async l=>{await t.markAsRead(l)},a=async()=>{await t.markAllAsRead()},f=async l=>{l.read||await t.markAsRead(l.id),l.type},D=async l=>{await t.deleteNotification(l)};return(l,h)=>(i(),c("div",j,[r("button",{onClick:u,class:"bell-button"},[h[0]||(h[0]=r("span",{class:"icon"},"ðŸ””",-1)),n(t).unreadCount>0?(i(),c("span",I,y(n(t).unreadCount),1)):d("",!0)]),e.value?(i(),c("div",J,[r("div",Y,[h[1]||(h[1]=r("h3",null,"Notifications",-1)),n(t).unreadCount>0?(i(),c("button",{key:0,onClick:a,disabled:n(t).markAsReadLoading,class:"mark-read-button"}," Mark all as read ",8,K)):d("",!0)]),n(t).loading?(i(),c("div",Q," Loading... ")):n(t).error?(i(),c("div",W,y(n(t).error),1)):n(t).notifications.length===0?(i(),c("div",X," No notifications ")):(i(),c("ul",Z,[(i(!0),c(U,null,z(n(t).sortedNotifications,m=>(i(),c("li",{key:m.id,class:F([{unread:!m.read},"notification-item"])},[r("div",{class:"notification-content",onClick:b=>f(m)},[r("p",et,y(m.title),1),r("p",ot,y(m.message),1),r("p",it,y(x(m.createdAt)),1)],8,tt),r("div",st,[m.read?d("",!0):(i(),c("button",{key:0,onClick:R(b=>C(m.id),["stop"]),class:"mark-read-button"}," Mark as read ",8,at)),r("button",{onClick:R(b=>D(m.id),["stop"]),class:"delete-button"}," Delete ",8,nt)])],2))),128))]))])):d("",!0)]))}}),ct=q(rt,[["__scopeId","data-v-26e49a71"]]),lt={class:"bg-gray-800 text-white p-4"},dt={class:"container mx-auto flex justify-between items-center"},ut={class:"flex space-x-4 items-center"},ft=E({__name:"Navbar",setup(o){const t=P(),e=g(),{isAuthenticated:s,isAdmin:u}=H(e),x=async()=>{e.logout(),t.push("/")};return(C,a)=>{const f=M;return i(),c("nav",lt,[r("div",dt,[B(f,{to:"/",class:"text-xl font-bold"},{default:_(()=>a[0]||(a[0]=[p("MTG Collector")])),_:1}),r("div",ut,[n(s)?(i(),k(f,{key:0,to:"/players",class:"hover:text-blue-300"},{default:_(()=>a[1]||(a[1]=[p(" Players ")])),_:1})):d("",!0),n(s)?(i(),k(f,{key:1,to:"/profile",class:"hover:text-blue-300"},{default:_(()=>a[2]||(a[2]=[p(" Profile ")])),_:1})):d("",!0),n(s)?(i(),k(f,{key:2,to:"/cards",class:"hover:text-blue-300"},{default:_(()=>a[3]||(a[3]=[p(" My Cards ")])),_:1})):d("",!0),n(s)?(i(),k(f,{key:3,to:"/decks",class:"hover:text-blue-300"},{default:_(()=>a[4]||(a[4]=[p(" My Decks ")])),_:1})):d("",!0),n(s)?(i(),k(f,{key:4,to:"/trades",class:"hover:text-blue-300"},{default:_(()=>a[5]||(a[5]=[p(" My Trades ")])),_:1})):d("",!0),n(u)?(i(),k(f,{key:5,to:"/admin",class:"hover:text-blue-300"},{default:_(()=>a[6]||(a[6]=[p(" Admin ")])),_:1})):d("",!0),n(u)?(i(),k(f,{key:6,to:"/notifications",class:"hover:text-blue-300"},{default:_(()=>a[7]||(a[7]=[p(" Notifications ")])),_:1})):d("",!0),n(s)?(i(),k(ct,{key:7,class:"text-black"})):d("",!0),n(s)?(i(),c("button",{key:8,onClick:x,class:"bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded"}," Logout ")):(i(),k(G,{key:9}))])])])}}}),ht={class:"min-h-screen flex flex-col bg-gray-100"},mt={class:"container mx-auto px-4 py-8"},kt={class:"bg-gray-800 text-white p-4 mt-8 mt-auto"},_t={class:"container mx-auto text-center"},At={__name:"default",setup(o){return(t,e)=>(i(),c("div",ht,[B(ft),r("div",mt,[V(t.$slots,"default")]),r("footer",kt,[r("div",_t," Â© "+y(new Date().getFullYear())+" MTG Collector ",1)])]))}};export{At as default};
