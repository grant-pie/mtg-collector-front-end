import{_ as k}from"./C8obXmBg.js";import{g as w,l as S,s as A,n as f,j as C,c as a,b as g,a as e,p as i,k as t,t as d,y as E,q as N,v as L,w as M,o as l,d as V}from"./DlFx1CQI.js";import{u as D}from"./Dw52imVu.js";import{_ as T}from"./CjSiZ1wG.js";const I={class:"mt-8"},B={key:0,class:"text-center py-10"},F={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"},P={key:2,class:"max-w-3xl mx-auto bg-white p-8 rounded shadow-md"},R={class:"flex items-center mb-6"},j={key:0,class:"mr-4"},q=["src"],$={class:"text-2xl font-bold"},z={class:"text-gray-600"},G={class:"mb-6"},H={key:0,class:"flex items-center"},J={class:"mr-4"},K={key:1,class:"mt-2"},O={class:"mb-3"},Q=["disabled"],W={key:0,class:"mb-3 text-red-600 text-sm"},X={key:1,class:"mb-3 text-green-600 text-sm"},Y={class:"flex space-x-2"},Z=["disabled"],ee=["disabled"],te={class:"mb-6"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={key:0},ne={key:1},re={class:"mb-6"},ae={key:3,class:"mt-4 p-4 bg-yellow-100 border border-yellow-400 rounded"},me=w({__name:"profile",setup(le){const o=S(),r=D(),{user:n,loading:p,error:b}=A(o),c=f(!1),u=f("");function x(){var m;u.value=((m=n.value)==null?void 0:m.username)||"",c.value=!0,r.resetUsernameUpdateState()}function _(){c.value=!1,r.resetUsernameUpdateState()}async function y(){if(!u.value.trim()){r.usernameUpdateError="Username cannot be empty";return}await r.updateUsername(u.value.trim())&&setTimeout(()=>{c.value=!1,r.resetUsernameUpdateState()},2e3)}async function v(){console.log("Manual fetch attempt with token:",o.token),await o.fetchUser(),console.log("After manual fetch - user:",o.user)}return C(async()=>{console.log("Profile component mounted"),console.log("Initial state - token:",o.token,"user:",o.user),await o.initAuth(),console.log("After initAuth - token:",o.token,"user:",o.user),!o.user&&o.token&&(console.log("No user data after initAuth, trying direct fetch"),await o.fetchUser(),console.log("After direct fetch - user:",o.user))}),(m,s)=>{const h=k;return l(),a("div",null,[g(T,{title:"User Profile",subtitle:"View and manage your account information"}),e("div",I,[t(p)?(l(),a("div",B,s[1]||(s[1]=[e("p",null,"Loading profile...",-1)]))):t(b)?(l(),a("div",F,d(t(b)),1)):t(n)?(l(),a("div",P,[e("div",R,[t(n).picture?(l(),a("div",j,[e("img",{src:t(n).picture,alt:"User avatar",class:"w-16 h-16 rounded-full"},null,8,q)])):i("",!0),e("div",null,[e("h2",$,d(t(n).firstName)+" "+d(t(n).lastName),1),e("p",z,d(t(n).email),1)])]),e("div",G,[s[3]||(s[3]=e("h3",{class:"text-xl font-semibold mb-2"},"Username",-1)),c.value?(l(),a("div",K,[e("form",{onSubmit:E(y,["prevent"]),class:"flex flex-col"},[e("div",O,[N(e("input",{"onUpdate:modelValue":s[0]||(s[0]=U=>u.value=U),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter new username",disabled:t(r).usernameUpdateLoading},null,8,Q),[[L,u.value]]),s[2]||(s[2]=e("p",{class:"text-xs text-gray-500 mt-1"}," Username must be 3-20 characters and can only contain letters, numbers, underscores and hyphens. ",-1))]),t(r).usernameUpdateError?(l(),a("div",W,d(t(r).usernameUpdateError),1)):i("",!0),t(r).usernameUpdateSuccess?(l(),a("div",X," Username updated successfully! ")):i("",!0),e("div",Y,[e("button",{type:"submit",class:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded",disabled:t(r).usernameUpdateLoading},d(t(r).usernameUpdateLoading?"Saving...":"Save"),9,Z),e("button",{type:"button",onClick:_,class:"bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded",disabled:t(r).usernameUpdateLoading}," Cancel ",8,ee)])],32)])):(l(),a("div",H,[e("p",J,d(t(n).username||"No username set"),1),e("button",{onClick:x,class:"bg-blue-500 hover:bg-blue-600 text-white text-sm py-1 px-3 rounded"}," Edit ")]))]),e("div",te,[s[7]||(s[7]=e("h3",{class:"text-xl font-semibold mb-2"},"Account Information",-1)),e("div",se,[e("div",null,[s[4]||(s[4]=e("p",{class:"text-gray-600"},"User ID",-1)),e("p",null,d(t(n).id),1)]),t(n).role?(l(),a("div",oe,[s[5]||(s[5]=e("p",{class:"text-gray-600"},"Role",-1)),e("p",null,d(t(n).role),1)])):i("",!0),t(n).createdAt?(l(),a("div",ne,[s[6]||(s[6]=e("p",{class:"text-gray-600"},"Member Since",-1)),e("p",null,d(new Date(t(n).createdAt).toLocaleDateString()),1)])):i("",!0)])]),e("div",re,[s[9]||(s[9]=e("h3",{class:"text-xl font-semibold mb-2"},"My Cards",-1)),g(h,{to:"/cards",class:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"},{default:M(()=>s[8]||(s[8]=[V(" View My Card Collection ")])),_:1})])])):i("",!0),!t(p)&&!t(n)?(l(),a("div",ae,[s[10]||(s[10]=e("h3",{class:"font-bold"},"Debug Information:",-1)),e("p",null,"Token exists: "+d(!!t(o).token),1),e("button",{onClick:v,class:"mt-2 bg-gray-200 hover:bg-gray-300 p-2 rounded"}," Try Fetch User ")])):i("",!0)])])}}});export{me as default};
