import{E as Y,y as k,l as T,c as m,o as f,a as t,n as U,t as p,F as E,r as D,s as _,m as j,C as $,j as ee,p as y,v,G as te,B as A,A as q,H as L,k as c,b as ae}from"./BNPd43ba.js";import{u as S}from"./Cp1D7Whl.js";const re=Y("card",{state:()=>({userCards:[],allCards:[],loading:!1,error:null,pagination:{totalItems:0,itemCount:0,itemsPerPage:10,totalPages:0,currentPage:1}}),actions:{async fetchUserCards(n,i=1,r=10){const u=S(),l=k();if(u.token)try{this.loading=!0,this.error=null;const g=await $fetch(`${l.public.apiBaseUrl}/user-cards/${n}`,{method:"GET",headers:{Authorization:`Bearer ${u.token}`},params:{page:i,limit:r}});this.userCards=g.cards||[],this.pagination=g.pagination||this.pagination}catch(g){console.error("Error fetching user cards:",g),this.error=g.message||"Failed to fetch cards"}finally{this.loading=!1}},async fetchCardsByUsername(n,i){const r=k();try{this.loading=!0,this.error=null,i||(i={}),i.page===void 0&&(i.page=1),i.limit===void 0&&(i.limit=10);const u=new URLSearchParams;for(const[x,d]of Object.entries(i))d!=null&&d!==""&&(Array.isArray(d)?d.forEach(h=>{u.append(x,h)}):u.append(x,d.toString()));const l=u.toString();let g=`${r.public.apiBaseUrl}/user-cards/username/${n}`;l&&(g+=`?${l}`);const b=await $fetch(g,{method:"GET"});return this.userCards=b.cards||[],this.pagination=b.pagination||this.pagination,this.userCards}catch(u){return console.error("Error fetching cards by username:",u),this.error=u.message||"Failed to fetch cards",[]}finally{this.loading=!1}},async searchUserCards(n,i={}){const r=S(),u=k();if(r.token)try{this.loading=!0,this.error=null,i.page===void 0&&(i.page=1),i.limit===void 0&&(i.limit=10);const l=new URLSearchParams;for(const[d,h]of Object.entries(i))h!=null&&h!==""&&(Array.isArray(h)?h.forEach(I=>{l.append(d,I)}):l.append(d,h.toString()));const g=l.toString(),b=`${u.public.apiBaseUrl}/user-cards/${n}${g?`?${g}`:""}`,x=await $fetch(b,{method:"GET",headers:{Authorization:`Bearer ${r.token}`}});this.userCards=x.cards||[],this.pagination=x.pagination||this.pagination}catch(l){console.error("Error searching user cards:",l),this.error=l.message||"Failed to search cards"}finally{this.loading=!1}},async goToPage(n,i,r={}){if(i<1||i>this.pagination.totalPages)return;const u={...r,page:i};if(r.username){const l=r.username;delete u.username,await this.fetchCardsByUsername(l,u)}else await this.searchUserCards(n,u)},async nextPage(n,i={}){this.pagination.currentPage<this.pagination.totalPages&&await this.goToPage(n,this.pagination.currentPage+1,i)},async prevPage(n,i={}){this.pagination.currentPage>1&&await this.goToPage(n,this.pagination.currentPage-1,i)},async addCardToUser(n,i){const r=S(),u=k();if(r.isAdmin)try{this.loading=!0,this.error=null;const l=await $fetch(`${u.public.apiBaseUrl}/user-cards/${n}`,{method:"POST",headers:{Authorization:`Bearer ${r.token}`,"Content-Type":"application/json"},body:{scryfallId:i}});return await this.fetchUserCards(n,this.pagination.currentPage),l}catch(l){console.error("Error adding card:",l),this.error=l.message||"Failed to add card"}finally{this.loading=!1}},async removeCard(n,i){const r=S(),u=k();if(r.token)try{this.loading=!0,this.error=null,await $fetch(`${u.public.apiBaseUrl}/user-cards/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${r.token}`}}),await this.fetchUserCards(i,this.pagination.currentPage)}catch(l){this.error=l.message||"Failed to remove card"}finally{this.loading=!1}},async searchCards(n){const i=S(),r=k();if(i.token)try{this.loading=!0,this.error=null;const u=new URLSearchParams;for(const[g,b]of Object.entries(n))b&&u.append(g,b.toString());const l=await $fetch(`${r.public.apiBaseUrl}/cards?${u.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${i.token}`}});return this.allCards=l||[],this.allCards}catch(u){return console.error("Error searching cards:",u),this.error=u.message||"Failed to search cards",[]}finally{this.loading=!1}},async fetchCardDetails(n){const i=S(),r=k();if(!i.token)return null;try{return await $fetch(`${r.public.apiBaseUrl}/cards/multiverse/${n}`,{method:"GET",headers:{Authorization:`Bearer ${i.token}`}})}catch(u){return console.error("Error fetching card details:",u),null}}}}),se={class:"bg-white shadow rounded p-4 flex justify-between"},oe={class:"font-bold"},ne={class:"text-sm text-gray-600"},ie={class:"mt-2"},le=["src","alt"],de={class:"text-sm"},ue={key:0},ce={key:1},ge={key:2},me={class:"mt-2 text-sm"},fe={key:0},ye=["onClick"],pe={__name:"CardItem",props:{card:{type:Object,required:!0},userId:{type:String,required:!1},actions:{type:Array,require:!1}},setup(n){const i=n,r=T(()=>new Date(i.card.createdAt).toISOString().split("T")[0]);return(u,l)=>(f(),m("div",se,[t("div",null,[t("h3",oe,p(n.card.cardDetails.name),1),t("p",ne,p(n.card.cardDetails.type),1),t("div",ie,[t("img",{src:n.card.cardDetails.imageUrl||`https://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=${n.card.cardDetails.multiverseId}&type=card`,alt:n.card.cardDetails.name,class:"w-40"},null,8,le),t("div",de,[n.card.cardDetails.manaCost?(f(),m("p",ue,"Mana Cost: "+p(n.card.cardDetails.manaCost),1)):U("",!0),n.card.cardDetails.rarity?(f(),m("p",ce,"Rarity: "+p(n.card.cardDetails.rarity),1)):U("",!0),n.card.createdAt?(f(),m("p",ge,"Received: "+p(r.value),1)):U("",!0)])]),t("div",me,[t("p",null,p(n.card.cardDetails.text),1)])]),n.actions?(f(),m("div",fe,[(f(!0),m(E,null,D(n.actions,g=>(f(),m("button",{key:g,onClick:b=>u.$emit("onClickAction",{action:g,card:n.card}),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded text-xs"},p(g),9,ye))),128))])):U("",!0)]))}},ve={class:"mb-6 bg-white p-4 rounded-lg shadow"},be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},he={class:"flex space-x-2 mt-1"},xe=["value"],Ce={class:"grid grid-cols-2 gap-2"},we={class:"flex space-x-2"},ke={key:0,class:"text-center py-10"},Pe={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"},Ae={key:2},Se={class:"mb-4 flex justify-between items-center"},Ue={class:"text-sm text-gray-600"},$e={key:0,class:"text-center py-10"},Be={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Te={key:0,class:"absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center"},Ee={key:2,class:"mt-6 flex justify-center"},De={class:"flex items-center space-x-2"},Ie=["disabled"],Ne=["disabled"],Ve={class:"flex space-x-1"},Me=["onClick"],Re=["disabled"],je=["disabled"],Oe={__name:"UserCardsList",props:{userName:{type:String,required:!1},userId:{type:String,required:!1},cardActions:{type:Array,required:!1},excludeCards:{type:Array,required:!1}},emits:["onClickAction"],setup(n,{emit:i}){const r=n,u=i,l=re(),{userCards:g,loading:b,error:x,pagination:d}=_(l),h=T(()=>g.value),I=s=>r.excludeCards?r.excludeCards.map(a=>a.id).includes(s.id):!1,o=j({name:"",type:"",rarity:"",set:"",manaCost:"",convertedManaCost:"",minPower:"",minToughness:"",text:"",artist:"",createdAt:"",createdAtStart:"",createdAtEnd:"",orderBy:"",orderDirection:"ASC",page:1,limit:10}),C=j(10),P=j([]),z=T(()=>r.userName),G=T(()=>{const s=d.value.totalPages,e=d.value.currentPage,a=5;if(s<=a)return Array.from({length:s},(X,R)=>R+1);let w=Math.max(1,e-Math.floor(a/2)),B=w+a-1;return B>s&&(B=s,w=Math.max(1,B-a+1)),Array.from({length:B-w+1},(X,R)=>w+R)});$(z,async()=>{r.userName&&(o.value.page=1,await l.fetchCardsByUsername(r.userName,{page:o.value.page,limit:C.value}))}),$(P,s=>{o.value.colors=s.length>0?s:void 0}),$(()=>[o.value.createdAtStart,o.value.createdAtEnd],([s,e])=>{(s||e)&&(o.value.createdAt="")}),$(()=>o.value.createdAt,s=>{s&&(o.value.createdAtStart="",o.value.createdAtEnd="")});const N=s=>s||"";ee(async()=>{r.userId&&await l.fetchUserCards(r.userId,1,C.value),r.userName&&await l.fetchCardsByUsername(r.userName,{page:1,limit:C.value})}),$(()=>r.userId,async s=>{s&&(O(),await l.fetchUserCards(s,1,C.value))});const V=async s=>{o.value.page=s,await F()},W=()=>{d.value.currentPage!==1&&V(1)},H=()=>{d.value.currentPage!==d.value.totalPages&&V(d.value.totalPages)},Z=async()=>{if(d.value.currentPage>1){const s={...M(),username:r.userName};r.userId?await l.prevPage(r.userId,s):r.userName&&await l.prevPage("",s)}},J=async()=>{if(d.value.currentPage<d.value.totalPages){const s={...M(),username:r.userName};r.userId?await l.nextPage(r.userId,s):r.userName&&await l.nextPage("",s)}},M=()=>{const s={};for(const[e,a]of Object.entries(o.value))a!==""&&a!==void 0&&a!==null&&(s[e]=a);return P.value.length>0&&(s.colors=P.value),s.createdAt&&(s.createdAt=N(s.createdAt)),s.createdAtStart&&(s.createdAtStart=N(s.createdAtStart)),s.createdAtEnd&&(s.createdAtEnd=N(s.createdAtEnd)),s.page=o.value.page,s.limit=C.value,s},F=async()=>{const s=M();r.userId?await l.searchUserCards(r.userId,s):r.userName&&await l.fetchCardsByUsername(r.userName,s)},K=async()=>{o.value.page=1,await F()},O=async()=>{o.value={name:"",type:"",rarity:"",set:"",manaCost:"",convertedManaCost:"",minPower:"",minToughness:"",text:"",artist:"",createdAt:"",createdAtStart:"",createdAtEnd:"",orderBy:"",orderDirection:"ASC",page:1,limit:C.value},P.value=[],r.userId?await l.fetchUserCards(r.userId,1,C.value):r.userName&&await l.fetchCardsByUsername(r.userName,{page:1,limit:C.value})},Q=s=>{u("onClickAction",s)};return(s,e)=>(f(),m("div",null,[t("div",ve,[e[33]||(e[33]=t("h3",{class:"text-lg font-medium mb-4"},"Search Cards",-1)),t("div",be,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"Card Name",-1)),y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.name=a),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.name]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700"},"Card Type",-1)),y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.type=a),type:"text",placeholder:"Creature, Instant, etc.",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.type]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700"},"Colors",-1)),t("div",he,[(f(),m(E,null,D(["W","U","B","R","G"],a=>t("label",{key:a,class:"inline-flex items-center"},[y(t("input",{type:"checkbox",value:a,"onUpdate:modelValue":e[2]||(e[2]=w=>P.value=w),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,8,xe),[[te,P.value]]),t("span",{class:A(["ml-1",{"text-yellow-500 font-bold":a==="W","text-blue-500 font-bold":a==="U","text-gray-800 font-bold":a==="B","text-red-500 font-bold":a==="R","text-green-500 font-bold":a==="G"}])},p(a),3)])),64))])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700"},"Rarity",-1)),y(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.rarity=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[19]||(e[19]=[L('<option value="">Any</option><option value="common">Common</option><option value="uncommon">Uncommon</option><option value="rare">Rare</option><option value="mythic">Mythic</option>',5)]),512),[[q,o.value.rarity]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700"},"Set",-1)),y(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.set=a),type:"text",placeholder:"e.g. ZNR",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.set]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700"},"Mana Cost",-1)),y(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.manaCost=a),type:"text",placeholder:"e.g. {2}{W}{W}",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.manaCost]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700"},"CMC",-1)),y(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.convertedManaCost=a),type:"number",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.convertedManaCost]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700"},"Min Power",-1)),y(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.minPower=a),type:"number",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.minPower]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700"},"Min Toughness",-1)),y(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.minToughness=a),type:"number",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.minToughness]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700"},"Card Text",-1)),y(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.text=a),type:"text",placeholder:"Search card text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.text]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"Artist",-1)),y(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.artist=a),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.artist]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700"},"Received On",-1)),y(t("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.createdAt=a),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[v,o.value.createdAt]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700"},"Received Between",-1)),t("div",Ce,[t("div",null,[y(t("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.createdAtStart=a),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"From"},null,512),[[v,o.value.createdAtStart]])]),t("div",null,[y(t("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.createdAtEnd=a),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"To"},null,512),[[v,o.value.createdAtEnd]])])])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700"},"Sort By",-1)),t("div",we,[y(t("select",{"onUpdate:modelValue":e[14]||(e[14]=a=>o.value.orderBy=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[30]||(e[30]=[L('<option value="">Default</option><option value="name">Name</option><option value="convertedManaCost">CMC</option><option value="rarity">Rarity</option><option value="set">Set</option><option value="createdAt">Received Date</option>',6)]),512),[[q,o.value.orderBy]]),y(t("select",{"onUpdate:modelValue":e[15]||(e[15]=a=>o.value.orderDirection=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[31]||(e[31]=[t("option",{value:"ASC"},"Ascending",-1),t("option",{value:"DESC"},"Descending",-1)]),512),[[q,o.value.orderDirection]])])])]),t("div",{class:"mt-4 flex justify-end space-x-3"},[t("button",{onClick:O,class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300"}," Reset "),t("button",{onClick:K,class:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700"}," Search ")])]),c(b)?(f(),m("div",ke,e[34]||(e[34]=[t("p",null,"Loading cards...",-1)]))):c(x)?(f(),m("div",Pe,p(c(x)),1)):(f(),m("div",Ae,[t("div",Se,[e[35]||(e[35]=t("h3",{class:"text-lg font-medium"},"Card List",-1)),t("p",Ue," Showing "+p(c(d).itemCount)+" of "+p(c(d).totalItems)+" cards (Page "+p(c(d).currentPage)+" of "+p(c(d).totalPages)+") ",1)]),h.value.length===0?(f(),m("div",$e,e[36]||(e[36]=[t("p",null,"No cards found matching your criteria.",-1)]))):(f(),m("div",Be,[(f(!0),m(E,null,D(c(g),a=>(f(),m("div",{key:a.id,class:"relative"},[ae(pe,{card:a,userId:n.userId,actions:n.cardActions,onOnClickAction:Q},null,8,["card","userId","actions"]),I(a)?(f(),m("div",Te,e[37]||(e[37]=[t("p",{class:"text-lg font-bold text-gray-800"},"Card in Deck",-1)]))):U("",!0)]))),128))])),c(d).totalPages>1?(f(),m("div",Ee,[t("nav",De,[t("button",{onClick:W,disabled:c(d).currentPage===1,class:A(["px-3 py-1 rounded border",c(d).currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white hover:bg-gray-50"])}," « ",10,Ie),t("button",{onClick:Z,disabled:c(d).currentPage===1,class:A(["px-3 py-1 rounded border",c(d).currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white hover:bg-gray-50"])}," ‹ ",10,Ne),t("div",Ve,[(f(!0),m(E,null,D(G.value,a=>(f(),m("button",{key:a,onClick:w=>V(a),class:A(["px-3 py-1 rounded border",a===c(d).currentPage?"bg-indigo-600 text-white":"bg-white hover:bg-gray-50"])},p(a),11,Me))),128))]),t("button",{onClick:J,disabled:c(d).currentPage===c(d).totalPages,class:A(["px-3 py-1 rounded border",c(d).currentPage===c(d).totalPages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white hover:bg-gray-50"])}," › ",10,Re),t("button",{onClick:H,disabled:c(d).currentPage===c(d).totalPages,class:A(["px-3 py-1 rounded border",c(d).currentPage===c(d).totalPages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white hover:bg-gray-50"])}," » ",10,je)])])):U("",!0)]))]))}};export{Oe as _,re as u};
