import{_ as D}from"./BY2CK4GQ.js";import{B as T,g,n as A,e as E,i as L,f as N,P as S,c,o as s,a as r,j as l,u as n,t as y,F as U,r as F,y as q,m as R,_ as z,q as P,s as V,b as B,w as _,d as p,A as k,Q as H}from"./DdnAVgIr.js";import{_ as j}from"./OcyOCblj.js";const G=T("notification",{state:()=>({notifications:[],unreadCount:0,loading:!1,error:null,markAsReadLoading:!1,markAsReadError:null}),getters:{unreadNotifications(){return this.notifications.filter(o=>!o.read)},readNotifications(){return this.notifications.filter(o=>o.read)},sortedNotifications(){return[...this.notifications].sort((o,t)=>o.read!==t.read?o.read?1:-1:new Date(t.createdAt).getTime()-new Date(o.createdAt).getTime())}},actions:{async fetchNotifications(){var t;const o=g();if(!o.token){this.error="Authentication required";return}this.loading=!0,this.error=null;try{const e=A(),i=await $fetch(`${e.public.apiBaseUrl}/notifications/my`,{headers:{Authorization:`Bearer ${o.token}`}});this.notifications=i}catch(e){console.error("Error fetching notifications:",e),this.error="Failed to load notifications",((t=e==null?void 0:e.response)==null?void 0:t.status)===401&&o.logout()}finally{this.loading=!1}},async fetchUnreadCount(){var t;const o=g();if(o.token)try{const e=A(),i=await $fetch(`${e.public.apiBaseUrl}/notifications/my/count`,{headers:{Authorization:`Bearer ${o.token}`}});this.unreadCount=i.count}catch(e){console.error("Error fetching unread count:",e),((t=e==null?void 0:e.response)==null?void 0:t.status)===401&&o.logout()}},async markAsRead(o){const t=g();if(!t.token)return this.markAsReadError="Authentication required",!1;this.markAsReadLoading=!0,this.markAsReadError=null;try{const e=A();await $fetch(`${e.public.apiBaseUrl}/notifications/${o}/read`,{method:"PATCH",headers:{Authorization:`Bearer ${t.token}`}});const i=this.notifications.find(f=>f.id===o);return i&&(i.read=!0),this.unreadCount=Math.max(0,this.unreadCount-1),!0}catch(e){return console.error("Error marking notification as read:",e),this.markAsReadError="Failed to mark notification as read",!1}finally{this.markAsReadLoading=!1}},async markAllAsRead(){const o=g();if(!o.token)return this.markAsReadError="Authentication required",!1;this.markAsReadLoading=!0,this.markAsReadError=null;try{const t=A();return await $fetch(`${t.public.apiBaseUrl}/notifications/my/read-all`,{method:"PATCH",headers:{Authorization:`Bearer ${o.token}`}}),this.notifications.forEach(e=>{e.read=!0}),this.unreadCount=0,!0}catch(t){return console.error("Error marking all notifications as read:",t),this.markAsReadError="Failed to mark all notifications as read",!1}finally{this.markAsReadLoading=!1}},async deleteNotification(o){const t=g();if(!t.token)return this.error="Authentication required",!1;try{const e=A();await $fetch(`${e.public.apiBaseUrl}/notifications/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.token}`}});const i=this.notifications.findIndex(f=>f.id===o);if(i!==-1){const f=!this.notifications[i].read;this.notifications.splice(i,1),f&&(this.unreadCount=Math.max(0,this.unreadCount-1))}return!0}catch(e){return console.error("Error deleting notification:",e),this.error="Failed to delete notification",!1}},addNotification(o){this.notifications.unshift(o),o.read||this.unreadCount++,this.notifications=[...this.notifications].sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},clearNotifications(){this.notifications=[],this.unreadCount=0,this.error=null}}}),I={class:"notification-bell"},O={key:0,class:"badge"},J={key:0,class:"notification-dropdown"},Q={class:"notification-header"},Y=["disabled"],K={key:0,class:"notification-loading"},W={key:1,class:"notification-error"},X={key:2,class:"no-notifications"},Z={key:3,class:"notification-list"},tt=["onClick"],et={class:"notification-title"},ot={class:"notification-message"},st={class:"notification-time"},it={class:"notification-actions"},at=["onClick"],nt=["onClick"],rt=E({__name:"NotificationBell",setup(o){const t=G(),e=L(!1);N(async()=>{await t.fetchNotifications(),await t.fetchUnreadCount()});const i=d=>{const h=document.querySelector(".notification-bell");h&&!h.contains(d.target)&&(e.value=!1)};N(()=>{document.addEventListener("click",i)}),S(()=>{document.removeEventListener("click",i)});const f=()=>{e.value=!e.value,e.value&&t.fetchNotifications()},x=d=>{const h=new Date(d),b=new Date().getTime()-h.getTime(),v=Math.floor(b/6e4),w=Math.floor(v/60),$=Math.floor(w/24);return v<60?v===0?"Just now":`${v}m ago`:w<24?`${w}h ago`:$<7?`${$}d ago`:h.toLocaleDateString()},C=async d=>{await t.markAsRead(d)},a=async()=>{await t.markAllAsRead()},u=async d=>{d.read||await t.markAsRead(d.id),d.type},M=async d=>{await t.deleteNotification(d)};return(d,h)=>(s(),c("div",I,[r("button",{onClick:f,class:"bell-button"},[h[0]||(h[0]=r("span",{class:"icon"},"ðŸ””",-1)),n(t).unreadCount>0?(s(),c("span",O,y(n(t).unreadCount),1)):l("",!0)]),e.value?(s(),c("div",J,[r("div",Q,[h[1]||(h[1]=r("h3",null,"Notifications",-1)),n(t).unreadCount>0?(s(),c("button",{key:0,onClick:a,disabled:n(t).markAsReadLoading,class:"mark-read-button"}," Mark all as read ",8,Y)):l("",!0)]),n(t).loading?(s(),c("div",K," Loading... ")):n(t).error?(s(),c("div",W,y(n(t).error),1)):n(t).notifications.length===0?(s(),c("div",X," No notifications ")):(s(),c("ul",Z,[(s(!0),c(U,null,F(n(t).sortedNotifications,m=>(s(),c("li",{key:m.id,class:q([{unread:!m.read},"notification-item"])},[r("div",{class:"notification-content",onClick:b=>u(m)},[r("p",et,y(m.title),1),r("p",ot,y(m.message),1),r("p",st,y(x(m.createdAt)),1)],8,tt),r("div",it,[m.read?l("",!0):(s(),c("button",{key:0,onClick:R(b=>C(m.id),["stop"]),class:"mark-read-button"}," Mark as read ",8,at)),r("button",{onClick:R(b=>M(m.id),["stop"]),class:"delete-button"}," Delete ",8,nt)])],2))),128))]))])):l("",!0)]))}}),ct=z(rt,[["__scopeId","data-v-26e49a71"]]),lt={class:"bg-gray-800 text-white p-4"},dt={class:"container mx-auto flex justify-between items-center"},ut={class:"flex space-x-4 items-center"},ft=E({__name:"Navbar",setup(o){const t=P(),e=g(),{isAuthenticated:i,isAdmin:f}=V(e),x=async()=>{e.logout(),t.push("/")};return(C,a)=>{const u=D;return s(),c("nav",lt,[r("div",dt,[B(u,{to:"/",class:"text-xl font-bold"},{default:_(()=>a[0]||(a[0]=[p("MTG Collector")])),_:1}),r("div",ut,[n(i)?(s(),k(u,{key:0,to:"/players",class:"hover:text-blue-300"},{default:_(()=>a[1]||(a[1]=[p(" Players ")])),_:1})):l("",!0),n(i)?(s(),k(u,{key:1,to:"/marketplace",class:"hover:text-blue-300"},{default:_(()=>a[2]||(a[2]=[p(" Marketplace ")])),_:1})):l("",!0),n(i)?(s(),k(u,{key:2,to:"/profile",class:"hover:text-blue-300"},{default:_(()=>a[3]||(a[3]=[p(" Profile ")])),_:1})):l("",!0),n(i)?(s(),k(u,{key:3,to:"/cards",class:"hover:text-blue-300"},{default:_(()=>a[4]||(a[4]=[p(" My Cards ")])),_:1})):l("",!0),n(i)?(s(),k(u,{key:4,to:"/decks",class:"hover:text-blue-300"},{default:_(()=>a[5]||(a[5]=[p(" My Decks ")])),_:1})):l("",!0),n(i)?(s(),k(u,{key:5,to:"/trades",class:"hover:text-blue-300"},{default:_(()=>a[6]||(a[6]=[p(" My Trades ")])),_:1})):l("",!0),n(f)?(s(),k(u,{key:6,to:"/admin",class:"hover:text-blue-300"},{default:_(()=>a[7]||(a[7]=[p(" Admin ")])),_:1})):l("",!0),n(f)?(s(),k(u,{key:7,to:"/notifications",class:"hover:text-blue-300"},{default:_(()=>a[8]||(a[8]=[p(" Notifications ")])),_:1})):l("",!0),n(i)?(s(),k(ct,{key:8,class:"text-black"})):l("",!0),n(i)?(s(),c("button",{key:9,onClick:x,class:"bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded"}," Logout ")):(s(),k(j,{key:10}))])])])}}}),ht={class:"min-h-screen flex flex-col bg-gray-100"},mt={class:"container mx-auto px-4 py-8"},kt={class:"bg-gray-800 text-white p-4 mt-8 mt-auto"},_t={class:"container mx-auto text-center"},At={__name:"default",setup(o){return(t,e)=>(s(),c("div",ht,[B(ft),r("div",mt,[H(t.$slots,"default")]),r("footer",kt,[r("div",_t," Â© "+y(new Date().getFullYear())+" MTG Collector ",1)])]))}};export{At as default};
