import{_ as H}from"./2AO4M_Kl.js";import{_ as K}from"./CI6s9x1A.js";import{g as Q,i as f,h as D,f as W,z as X,c as r,j as v,u as g,a as t,t as l,b as E,w as L,y as Z,d as b,F as h,r as I,q as ee,l as te,o as a}from"./IaO6qu-2.js";import{u as se,T as m}from"./BH2QneOk.js";import{u as re}from"./CVmZogfO.js";import{u as ae}from"./BzrFCopc.js";const oe={key:0,class:"flex justify-center my-10"},de={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6"},le={key:2,class:"text-center my-10"},ie={key:3,class:"bg-white rounded-lg shadow"},ne={class:"border-b p-6"},ue={class:"flex justify-between items-center"},ce={class:"text-gray-600"},ve={class:"flex items-center"},ge={class:"p-6 border-b"},me={class:"grid md:grid-cols-2 gap-6"},pe={class:"space-y-2"},ye={key:0},xe={class:"flex flex-col md:flex-row md:justify-around items-center p-4 bg-gray-50 rounded-lg"},fe={class:"text-center mb-4 md:mb-0"},be={class:"font-medium"},he={class:"text-xs text-gray-500"},_e={class:"text-center"},Ce={class:"font-medium"},we={class:"text-xs text-gray-500"},ke={class:"p-6"},Te={class:"grid md:grid-cols-2 gap-6"},Se={class:"font-medium text-gray-700 mb-3"},De={key:0,class:"text-center p-6 bg-gray-50 rounded-lg"},Ee={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Ie={key:0,class:"mb-1"},Ae={class:"text-sm mr-2"},je=["src"],Be={key:1,class:"flex items-center"},Ne={key:2,class:"mt-4"},Re={class:"font-medium text-gray-700 mb-3"},Le={key:0,class:"text-center p-6 bg-gray-50 rounded-lg"},Ue={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},qe={key:0,class:"mb-1"},Pe={class:"text-sm mr-2"},Me=["src"],Oe={key:1,class:"flex items-center"},$e={key:2,class:"mt-4"},Ye={class:"p-6 bg-gray-50 border-t"},Ve={key:0,class:"flex justify-end space-x-3"},ze=["disabled"],Fe=["disabled"],Ge=["disabled"],Je={key:1,class:"text-center text-green-600"},He={key:2,class:"text-center text-red-600"},Ke={key:3,class:"text-center text-gray-600"},Qe={key:4,class:"fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 flex items-center justify-center"},We={class:"relative bg-white w-full max-w-6xl mx-auto rounded-lg shadow-xl p-6"},Xe={class:"text-xl font-bold mb-4"},Ze={class:"mb-4"},et={key:0,class:"mb-6"},tt={class:"font-medium mb-2"},st={class:"flex flex-wrap gap-2"},rt={key:0,class:"text-sm mr-2"},at={key:1,class:"text-sm mr-2"},ot=["onClick"],dt={class:"mt-6 flex justify-end space-x-3"},lt=["disabled"],yt={__name:"[id]",setup(it){const U=te(),A=ee(),u=se(),j=re(),_=Q(),C=ae(),w=f(!1),p=f("initiator"),c=f([]),n=f({}),B=f(!1),x=D(()=>U.params.id),s=D(()=>u.currentTrade),y=D(()=>!s.value||!_.user?!1:s.value.initiatorId===_.user.id);W(async()=>{x.value&&await Promise.all([u.fetchTradeById(x.value),j.fetchAllUsernames()])}),X(s,async o=>{o&&await q()},{immediate:!0});const q=async()=>{if(!s.value)return;B.value=!0;const o=[...s.value.initiatorCards,...s.value.receiverCards];for(const e of o)if(!n.value[e]){const i=await C.fetchCardById(e);i&&(n.value[e]=i)}B.value=!1},k=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=o=>{switch(o){case m.PENDING:return"Pending";case m.ACCEPTED:return"Accepted";case m.REJECTED:return"Rejected";case m.CANCELED:return"Canceled";default:return o}},M=o=>{switch(o){case m.PENDING:return"bg-yellow-100 text-yellow-800";case m.ACCEPTED:return"bg-green-100 text-green-800";case m.REJECTED:return"bg-red-100 text-red-800";case m.CANCELED:return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},T=o=>{const e=j.publicUsernames.find(i=>i.id===o);return e?e.username:o.substring(0,8)},N=o=>{var e;return o===((e=_.user)==null?void 0:e.id)},O=o=>o.substring(0,8)+"...",R=o=>{p.value=o,c.value=o==="initiator"?[...s.value.initiatorCards.map(e=>({id:e}))]:[...s.value.receiverCards.map(e=>({id:e}))],w.value=!0,c.value.forEach(async e=>{if(!n.value[e.id]){const i=await C.fetchCardById(e.id);i&&(n.value[e.id]=i)}})},S=()=>{w.value=!1,c.value=[]},$=async({action:o,card:e})=>{if(o==="trade"&&!c.value.some(i=>i.id===e.id)&&(c.value.push(e),!n.value[e.id])){const i=await C.fetchCardById(e.id);i&&(n.value[e.id]=i)}},Y=o=>{c.value=c.value.filter(e=>e.id!==o.id)},V=async()=>{try{const o={receiverId:s.value.receiverId,initiatorCardIds:p.value==="initiator"?c.value.map(i=>i.id):s.value.initiatorCards,receiverCardIds:p.value==="receiver"?c.value.map(i=>i.id):s.value.receiverCards};await u.cancelTrade(s.value.id);const e=await u.createTrade(o);e&&(S(),A.push(`/trades/${e.id}`))}catch(o){console.error("Error updating trade:",o)}},z=async()=>{confirm("Are you sure you want to cancel this trade?")&&(await u.cancelTrade(x.value),A.push("/trades"))},F=async()=>{confirm("Are you sure you want to accept this trade?")&&await u.respondToTrade(x.value,{accept:!0})},G=async()=>{confirm("Are you sure you want to reject this trade?")&&await u.respondToTrade(x.value,{accept:!1})};return(o,e)=>{const i=H,J=K;return a(),r(h,null,[g(u).loading?(a(),r("div",oe,e[3]||(e[3]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"},null,-1)]))):g(u).error?(a(),r("div",de,[t("p",null,l(g(u).error),1),t("button",{onClick:e[0]||(e[0]=(...d)=>g(u).resetErrorState&&g(u).resetErrorState(...d)),class:"text-sm underline"},"Dismiss")])):s.value?(a(),r("div",ie,[t("div",ne,[t("div",ue,[t("div",null,[e[6]||(e[6]=t("h1",{class:"text-2xl font-bold"},"Trade Details",-1)),t("p",ce,"Trade ID: "+l(s.value.id),1)]),t("div",ve,[t("span",{class:Z(["text-sm px-3 py-1 rounded-full mr-3",M(s.value.status)])},l(P(s.value.status)),3),E(i,{to:"/trades",class:"text-gray-500 hover:text-gray-700"},{default:L(()=>e[7]||(e[7]=[b(" Back to trades ")])),_:1})])])]),t("div",ge,[t("div",me,[t("div",null,[e[11]||(e[11]=t("h2",{class:"text-lg font-semibold mb-2"},"Trade Info",-1)),t("ul",pe,[t("li",null,[e[8]||(e[8]=t("span",{class:"text-gray-600"},"Created:",-1)),b(" "+l(k(s.value.createdAt)),1)]),s.value.respondedAt?(a(),r("li",ye,[e[9]||(e[9]=t("span",{class:"text-gray-600"},"Responded:",-1)),b(" "+l(k(s.value.respondedAt)),1)])):v("",!0),t("li",null,[e[10]||(e[10]=t("span",{class:"text-gray-600"},"Last Updated:",-1)),b(" "+l(k(s.value.updatedAt)),1)])])]),t("div",null,[e[15]||(e[15]=t("h2",{class:"text-lg font-semibold mb-2"},"Trade Partners",-1)),t("div",xe,[t("div",fe,[e[12]||(e[12]=t("p",{class:"text-sm text-gray-500"},"Initiator",-1)),t("p",be,l(T(s.value.initiatorId)),1),t("p",he,l(N(s.value.initiatorId)?"(You)":""),1)]),e[14]||(e[14]=t("div",{class:"text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 8l4 4m0 0l-4 4m4-4H3"})])],-1)),t("div",_e,[e[13]||(e[13]=t("p",{class:"text-sm text-gray-500"},"Receiver",-1)),t("p",Ce,l(T(s.value.receiverId)),1),t("p",we,l(N(s.value.receiverId)?"(You)":""),1)])])])])]),t("div",ke,[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold mb-4"},"Cards Being Traded",-1)),t("div",Te,[t("div",null,[t("h3",Se,l(y.value?"Your Offered Cards":"Cards Offered to You"),1),s.value.initiatorCards.length===0?(a(),r("div",De,e[16]||(e[16]=[t("p",{class:"text-gray-500"},"No cards offered in this trade",-1)]))):(a(),r("div",Ee,[(a(!0),r(h,null,I(s.value.initiatorCards,d=>(a(),r("div",{key:d,class:"border rounded-lg p-3 bg-gray-50"},[n.value[d]?(a(),r("div",Ie,[t("span",Ae,l(n.value[d].cardDetails.name),1),n.value[d]?(a(),r("img",{key:0,src:n.value[d].cardDetails.imageUrl},null,8,je)):v("",!0)])):(a(),r("div",Be,e[17]||(e[17]=[t("div",{class:"animate-pulse h-4 w-24 bg-gray-200 rounded mb-1"},null,-1),t("p",{class:"text-xs text-gray-500 ml-1"},"loading...",-1)])))]))),128))])),y.value&&s.value.status==="pending"?(a(),r("div",Ne,[t("button",{onClick:e[1]||(e[1]=d=>R("initiator")),class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition"},l(s.value.initiatorCards.length>0?"Edit Offered Cards":"Add Cards to Offer"),1)])):v("",!0)]),t("div",null,[t("h3",Re,l(y.value?"Cards Requested from Partner":"Your Cards Requested"),1),s.value.receiverCards.length===0?(a(),r("div",Le,e[18]||(e[18]=[t("p",{class:"text-gray-500"},"No cards requested in this trade",-1)]))):(a(),r("div",Ue,[(a(!0),r(h,null,I(s.value.receiverCards,d=>(a(),r("div",{key:d,class:"border rounded-lg p-3 bg-gray-50"},[n.value[d]?(a(),r("div",qe,[t("span",Pe,l(n.value[d].cardDetails.name),1),n.value[d]?(a(),r("img",{key:0,src:n.value[d].cardDetails.imageUrl},null,8,Me)):v("",!0)])):(a(),r("div",Oe,e[19]||(e[19]=[t("div",{class:"animate-pulse h-4 w-24 bg-gray-200 rounded mb-1"},null,-1),t("p",{class:"text-xs text-gray-500 ml-1"},"loading...",-1)])))]))),128))])),y.value&&s.value.status==="pending"?(a(),r("div",$e,[t("button",{onClick:e[2]||(e[2]=d=>R("receiver")),class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition"},l(s.value.receiverCards.length>0?"Edit Requested Cards":"Request Cards"),1)])):v("",!0)])])]),t("div",Ye,[s.value.status==="pending"?(a(),r("div",Ve,[y.value?(a(),r("button",{key:0,onClick:z,class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded transition",disabled:g(u).loading}," Cancel Trade ",8,ze)):v("",!0),y.value?v("",!0):(a(),r(h,{key:1},[t("button",{onClick:G,class:"px-4 py-2 bg-white border border-red-500 text-red-500 hover:bg-red-50 rounded transition",disabled:g(u).respondTradeLoading}," Reject ",8,Fe),t("button",{onClick:F,class:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded transition",disabled:g(u).respondTradeLoading}," Accept ",8,Ge)],64))])):s.value.status==="accepted"?(a(),r("div",Je,e[21]||(e[21]=[t("p",null,"This trade has been completed successfully.",-1)]))):s.value.status==="rejected"?(a(),r("div",He,e[22]||(e[22]=[t("p",null,"This trade was rejected.",-1)]))):s.value.status==="canceled"?(a(),r("div",Ke,e[23]||(e[23]=[t("p",null,"This trade was canceled.",-1)]))):v("",!0)])])):(a(),r("div",le,[e[5]||(e[5]=t("p",{class:"text-gray-600"},"Trade not found or you don't have permission to view it.",-1)),E(i,{to:"/trades",class:"text-blue-500 hover:text-blue-600 mt-2 inline-block"},{default:L(()=>e[4]||(e[4]=[b("Back to trades")])),_:1})])),w.value?(a(),r("div",Qe,[t("div",We,[t("button",{onClick:S,class:"absolute top-4 right-4 text-gray-500 hover:text-gray-700"},e[24]||(e[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),t("h2",Xe,l(p.value==="initiator"?"Select Cards to Offer":"Select Cards to Request"),1),t("div",Ze,[t("p",null,l(p.value==="initiator"?"Select cards from your collection to offer in this trade.":`Select cards from ${T(s.value.receiverId)}'s collection to request in this trade.`),1)]),c.value.length>0?(a(),r("div",et,[t("h3",tt,"Selected Cards ("+l(c.value.length)+")",1),t("div",st,[(a(!0),r(h,null,I(c.value,d=>(a(),r("div",{key:d.id,class:"bg-blue-50 border border-blue-200 rounded px-3 py-1 flex items-center"},[n.value[d.id]?(a(),r("span",rt,l(n.value[d.id].cardDetails.name),1)):(a(),r("span",at,l(O(d.id)),1)),t("button",{onClick:nt=>Y(d),class:"text-red-500 hover:text-red-700"},e[25]||(e[25]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ot)]))),128))])])):v("",!0),E(J,{userId:p.value==="initiator"?s.value.initiatorId:s.value.receiverId,cardActions:["trade"],excludeCards:c.value,onOnClickAction:$},null,8,["userId","excludeCards"]),t("div",dt,[t("button",{onClick:S,class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300"}," Cancel "),t("button",{onClick:V,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:c.value.length===0}," Update Trade ",8,lt)])])])):v("",!0)],64)}}};export{yt as default};
