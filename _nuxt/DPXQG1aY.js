import{H as f,l,z as o}from"./BgyqXIzg.js";const g=[10,20,50],p=10,y=f("card",{state:()=>({userCards:[],allCards:[],loading:!1,error:null,pagination:{totalItems:0,itemCount:0,itemsPerPage:10,totalPages:0,currentPage:1},validPageSizes:g}),actions:{async fetchCardById(i){const e=l(),r=o();if(!e.token)return null;try{return this.loading=!0,this.error=null,(await $fetch(`${r.public.apiBaseUrl}/user-cards/${i}`,{method:"GET",headers:{Authorization:`Bearer ${e.token}`}})).userCard}catch(t){return console.error("Error fetching card by ID:",t),this.error=t.message||"Failed to fetch card",null}finally{this.loading=!1}},async fetchUserCards(i,e=1,r=10){const t=l(),a=o();if(t.token)try{this.loading=!0,this.error=null;const s=this.validatePageSize(r),n=await $fetch(`${a.public.apiBaseUrl}/user-cards/user/${i}`,{method:"GET",headers:{Authorization:`Bearer ${t.token}`},params:{page:e,limit:s}});this.userCards=n.cards||[],this.pagination=n.pagination||this.pagination}catch(s){console.error("Error fetching user cards:",s),this.error=s.message||"Failed to fetch cards"}finally{this.loading=!1}},async fetchCardsByUsername(i,e){const r=o();try{this.loading=!0,this.error=null,e||(e={}),e.page===void 0&&(e.page=1),e.limit===void 0&&(e.limit=10),e.limit=this.validatePageSize(e.limit);const t=new URLSearchParams;for(const[d,c]of Object.entries(e))c!=null&&c!==""&&(Array.isArray(c)?c.forEach(h=>{t.append(d,h)}):t.append(d,c.toString()));const a=t.toString();let s=`${r.public.apiBaseUrl}/user-cards/username/${i}`;a&&(s+=`?${a}`);const n=await $fetch(s,{method:"GET"});return this.userCards=n.cards||[],this.pagination=n.pagination||this.pagination,this.userCards}catch(t){return console.error("Error fetching cards by username:",t),this.error=t.message||"Failed to fetch cards",[]}finally{this.loading=!1}},async searchUserCards(i,e={}){const r=l(),t=o();if(r.token)try{this.loading=!0,this.error=null,e.page===void 0&&(e.page=1),e.limit===void 0&&(e.limit=10),e.limit=this.validatePageSize(e.limit);const a=new URLSearchParams;for(const[c,h]of Object.entries(e))h!=null&&h!==""&&(Array.isArray(h)?h.forEach(u=>{a.append(c,u)}):a.append(c,h.toString()));const s=a.toString(),n=`${t.public.apiBaseUrl}/user-cards/user/${i}${s?`?${s}`:""}`,d=await $fetch(n,{method:"GET",headers:{Authorization:`Bearer ${r.token}`}});this.userCards=d.cards||[],this.pagination=d.pagination||this.pagination}catch(a){console.error("Error searching user cards:",a),this.error=a.message||"Failed to search cards"}finally{this.loading=!1}},async goToPage(i,e,r={}){if(e<1||e>this.pagination.totalPages)return;const t={...r,page:e};if(r.username){const a=r.username;delete t.username,await this.fetchCardsByUsername(a,t)}else await this.searchUserCards(i,t)},async nextPage(i,e={}){if(this.pagination.currentPage<this.pagination.totalPages){const r={...e,page:this.pagination.currentPage+1};r.limit||(r.limit=this.pagination.itemsPerPage),await this.goToPage(i,this.pagination.currentPage+1,r)}},async prevPage(i,e={}){if(this.pagination.currentPage>1){const r={...e,page:this.pagination.currentPage-1};r.limit||(r.limit=this.pagination.itemsPerPage),await this.goToPage(i,this.pagination.currentPage-1,r)}},async changeItemsPerPage(i,e,r={}){const t=this.validatePageSize(e),a={...r,limit:t,page:1};if(r.username){const s=r.username;delete a.username,await this.fetchCardsByUsername(s,a)}else await this.searchUserCards(i,a)},validatePageSize(i){const e=typeof i=="string"?parseInt(i,10):i;return!isNaN(e)&&g.includes(e)?e:this.pagination&&this.pagination.itemsPerPage&&g.includes(this.pagination.itemsPerPage)?this.pagination.itemsPerPage:p},async addCardToUser(i,e){const r=l(),t=o();if(r.isAdmin)try{this.loading=!0,this.error=null;const a=await $fetch(`${t.public.apiBaseUrl}/user-cards/${i}`,{method:"POST",headers:{Authorization:`Bearer ${r.token}`,"Content-Type":"application/json"},body:{scryfallId:e}});return await this.fetchUserCards(i,this.pagination.currentPage,this.pagination.itemsPerPage),a}catch(a){console.error("Error adding card:",a),this.error=a.message||"Failed to add card"}finally{this.loading=!1}},async removeCard(i,e){const r=l(),t=o();if(r.token)try{this.loading=!0,this.error=null,await $fetch(`${t.public.apiBaseUrl}/user-cards/${i}`,{method:"DELETE",headers:{Authorization:`Bearer ${r.token}`}}),await this.fetchUserCards(e,this.pagination.currentPage,this.pagination.itemsPerPage)}catch(a){this.error=a.message||"Failed to remove card"}finally{this.loading=!1}},async revealCard(i,e){const r=l(),t=o();if(r.token)try{this.loading=!0,this.error=null;const a=await $fetch(`${t.public.apiBaseUrl}/user-cards/${i}/reveal`,{method:"PATCH",headers:{Authorization:`Bearer ${r.token}`}});return await this.fetchUserCards(e,this.pagination.currentPage,this.pagination.itemsPerPage),a.userCard}catch(a){console.error("Error revealing card:",a),this.error=a.message||"Failed to reveal card"}finally{this.loading=!1}},async setWillingToTrade(i,e,r){const t=l(),a=o();if(t.token){console.log(r);try{this.loading=!0,this.error=null;const s=await $fetch(`${a.public.apiBaseUrl}/user-cards/${i}/trade-willing`,{method:"PATCH",headers:{Authorization:`Bearer ${t.token}`},body:{willingToTrade:!r}});return await this.fetchUserCards(e,this.pagination.currentPage,this.pagination.itemsPerPage),s.userCard}catch(s){console.error("Error revealing card:",s),this.error=s.message||"Failed to reveal card"}finally{this.loading=!1}}},async searchCards(i){const e=l(),r=o();if(e.token)try{this.loading=!0,this.error=null;const t=new URLSearchParams;for(const[s,n]of Object.entries(i))n&&t.append(s,n.toString());const a=await $fetch(`${r.public.apiBaseUrl}/cards?${t.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${e.token}`}});return this.allCards=a||[],this.allCards}catch(t){return console.error("Error searching cards:",t),this.error=t.message||"Failed to search cards",[]}finally{this.loading=!1}},async fetchCardDetails(i){const e=l(),r=o();if(!e.token)return null;try{return await $fetch(`${r.public.apiBaseUrl}/cards/multiverse/${i}`,{method:"GET",headers:{Authorization:`Bearer ${e.token}`}})}catch(t){return console.error("Error fetching card details:",t),null}}}});export{y as u};
