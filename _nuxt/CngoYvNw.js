import{B as u,g as s,n as c}from"./CGWYguua.js";var f=(e=>(e.PENDING="pending",e.ACCEPTED="accepted",e.REJECTED="rejected",e.CANCELED="canceled",e))(f||{});const g=u("trade",{state:()=>({trades:[],pendingTrades:[],currentTrade:null,loading:!1,error:null,createTradeLoading:!1,createTradeError:null,respondTradeLoading:!1,respondTradeError:null}),getters:{initiatedTrades:e=>{const r=s();return e.trades.filter(t=>{var a;return t.initiatorId===((a=r.user)==null?void 0:a.id)})},receivedTrades:e=>{const r=s();return e.trades.filter(t=>{var a;return t.receiverId===((a=r.user)==null?void 0:a.id)})}},actions:{async fetchAllTrades(){const e=s();if(!e.token){this.error="Authentication required";return}this.loading=!0,this.error=null;try{const r=c(),t=await $fetch(`${r.public.apiBaseUrl}/trades`,{headers:{Authorization:`Bearer ${e.token}`}});this.trades=t.trades}catch(r){console.error("Error fetching trades:",r),this.error="Failed to load trades"}finally{this.loading=!1}},async fetchPendingTrades(){const e=s();if(!e.token){this.error="Authentication required";return}this.loading=!0,this.error=null;try{const r=c(),t=await $fetch(`${r.public.apiBaseUrl}/trades/pending`,{headers:{Authorization:`Bearer ${e.token}`}});this.pendingTrades=t.trades}catch(r){console.error("Error fetching pending trades:",r),this.error="Failed to load pending trades"}finally{this.loading=!1}},async fetchTradeById(e){const r=s();if(!r.token){this.error="Authentication required";return}this.loading=!0,this.error=null;try{const t=c(),a=await $fetch(`${t.public.apiBaseUrl}/trades/${e}`,{headers:{Authorization:`Bearer ${r.token}`}});this.currentTrade=a.trade}catch(t){console.error(`Error fetching trade ${e}:`,t),this.error="Failed to load trade"}finally{this.loading=!1}},async createTrade(e){var t;const r=s();if(!r.token)return this.createTradeError="Authentication required",null;this.createTradeLoading=!0,this.createTradeError=null;try{const a=c(),n=await $fetch(`${a.public.apiBaseUrl}/trades`,{method:"POST",headers:{Authorization:`Bearer ${r.token}`,"Content-Type":"application/json"},body:JSON.stringify(e)});return this.trades.push(n.trade),n.trade.status==="pending"&&this.pendingTrades.push(n.trade),n.trade}catch(a){return console.error("Error creating trade:",a),this.createTradeError=((t=a.data)==null?void 0:t.message)||"Failed to create trade",null}finally{this.createTradeLoading=!1}},async respondToTrade(e,r){var a,n;const t=s();if(!t.token)return this.respondTradeError="Authentication required",null;this.respondTradeLoading=!0,this.respondTradeError=null;try{const i=c(),o=await $fetch(`${i.public.apiBaseUrl}/trades/${e}/respond`,{method:"PATCH",headers:{Authorization:`Bearer ${t.token}`,"Content-Type":"application/json"},body:JSON.stringify(r)}),l=this.trades.findIndex(h=>h.id===e);l!==-1&&(this.trades[l]=o.trade);const d=this.pendingTrades.findIndex(h=>h.id===e);return d!==-1&&this.pendingTrades.splice(d,1),((a=this.currentTrade)==null?void 0:a.id)===e&&(this.currentTrade=o.trade),o.trade}catch(i){return console.error(`Error responding to trade ${e}:`,i),this.respondTradeError=((n=i.data)==null?void 0:n.message)||"Failed to respond to trade",null}finally{this.respondTradeLoading=!1}},async cancelTrade(e){var t,a;const r=s();if(!r.token)return this.error="Authentication required",null;this.loading=!0,this.error=null;try{const n=c(),i=await $fetch(`${n.public.apiBaseUrl}/trades/${e}/cancel`,{method:"PATCH",headers:{Authorization:`Bearer ${r.token}`}}),o=this.trades.findIndex(d=>d.id===e);o!==-1&&(this.trades[o]=i.trade);const l=this.pendingTrades.findIndex(d=>d.id===e);return l!==-1&&this.pendingTrades.splice(l,1),((t=this.currentTrade)==null?void 0:t.id)===e&&(this.currentTrade=i.trade),i.trade}catch(n){return console.error(`Error canceling trade ${e}:`,n),this.error=((a=n.data)==null?void 0:a.message)||"Failed to cancel trade",null}finally{this.loading=!1}},resetCreateTradeState(){this.createTradeLoading=!1,this.createTradeError=null},resetRespondTradeState(){this.respondTradeLoading=!1,this.respondTradeError=null},resetErrorState(){this.error=null}}});export{f as T,g as u};
