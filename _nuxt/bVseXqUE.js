import{_ as ne}from"./CQjWgFAY.js";import{l as de,s as ue,n as v,m as i,j as ie,c as l,b as L,p as ce,k,a as r,t as m,w as ve,q as S,v as pe,C as B,F as x,r as w,x as me,B as ye,o as n,d as fe,D as ge}from"./BgyqXIzg.js";import{u as be}from"./C76lTa6B.js";import{u as Ce}from"./DPXQG1aY.js";import{_ as ke}from"./Dd-ahDQ5.js";import{_ as xe}from"./XdOx3kv9.js";import{_ as we}from"./DqUe2pw6.js";const he={key:0,class:"text-center py-10"},De={key:1,class:"text-center py-10"},_e={key:2,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded my-4"},$e={key:3,class:"text-center py-10"},Le={key:4,class:"mt-8"},Se={class:"flex justify-between"},Te={class:"flex mb-6 mt-5 bg-white shadow rounded p-4"},Ae=["innerHTML"],Me={class:"flex justify-between items-center mb-6"},Re={class:"mb-6 bg-white shadow rounded p-4"},Be={class:"mb-4"},Ie={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Ue=["value"],Fe=["value"],He=["value"],Ne={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ve={class:"font-bold"},Ee={class:"text-sm text-gray-600"},je={class:"flex space-x-1 mt-1"},Pe=["title"],ze={class:"mt-2"},Ge=["src","alt"],Oe={class:"mt-2"},Qe=["onClick"],We={key:1,class:"text-center py-10 bg-gray-50 rounded"},qe={key:2,class:"text-center py-10 bg-gray-50 rounded"},Ye={key:5,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Je={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-4xl h-3/4 flex flex-col"},Ke={class:"flex-grow overflow-y-auto"},Xe={class:"mt-4 pt-4 border-t flex justify-end"},nt={__name:"[id]",setup(Ze){const W=me();ye();const I=de(),u=be(),T=Ce(),{isAuthenticated:U,user:A}=ue(I),h=v(!1),D=v(""),g=v(""),b=v(""),C=v(""),q=v(""),F=v(""),H=v(""),N=v(""),p=i(()=>W.params.id),o=i(()=>u.currentDeck),Y=i(()=>{if(!o.value||!o.value.userCards||o.value.userCards.length===0||!o.value.userCards[0]||!o.value.userCards[0].card)return"";let t="",e="",d="",c="",s="",f="",_="",j=0,P=0,z=0,G=0,O=0,Q=0,$=[{name:"",type:""}];for(const a of o.value.userCards)if(a.card)if(!$.some(R=>R.name===a.card.name))$.push({name:a.card.name,type:a.card.type,count:1});else{const R=$.find(le=>le.name===a.card.name);R.count++}for(const a of $)a.type.includes("Land")&&(j+=a.count,e+=`<p>${a.name} (${a.count})</p>`),a.type.includes("Artifact")&&(P+=a.count,d+=`<p>${a.name} (${a.count})</p>`),a.type.includes("Enchantment")&&(z+=a.count,c+=`<p>${a.name} (${a.count})</p>`),a.type.includes("Instant")&&(O+=a.count,s+=`<p>${a.name} (${a.count})</p>`),a.type.includes("Sorcery")&&(G+=a.count,f+=`<p>${a.name} (${a.count})</p>`),a.type.includes("Creature")&&(Q+=a.count,_+=`<p>${a.name} (${a.count})</p>`);return t+=`<strong> Lands (${j}) </strong><br>`,t+=e+"<br>",t+=`<strong> Artifacts (${P}) </strong><br>`,t+=d+"<br>",t+=`<strong> Enchantments(${z}) </strong><br>`,t+=c+"<br>",t+=`<strong> Instants (${O}) </strong><br>`,t+=s+"<br>",t+=`<strong> Sorcery (${G}) </strong><br>`,t+=f+"<br>",t+=`<strong> Creature (${Q}) </strong><br>`,t+=_+"<br>",t}),M=[{code:"W",name:"White",class:"bg-yellow-100 border border-yellow-400"},{code:"U",name:"Blue",class:"bg-blue-500"},{code:"B",name:"Black",class:"bg-gray-800"},{code:"R",name:"Red",class:"bg-red-600"},{code:"G",name:"Green",class:"bg-green-600"}],J=i(()=>{if(!o.value||!o.value.userCards||o.value.userCards.length===0)return[];const t=o.value.userCards.filter(e=>e.card&&e.card.type).map(e=>e.card.type.split(" ")[0]);return[...new Set(t)].sort()}),K=i(()=>{if(!o.value||!o.value.userCards||o.value.userCards.length===0)return[];const t=o.value.userCards.filter(e=>e.card&&e.card.rarity).map(e=>e.card.rarity);return[...new Set(t)].sort()}),X=i(()=>M);i(()=>{if(!y.value)return[];const t=y.value.map(e=>e.cardDetails.type.split(" ")[0]);return[...new Set(t)].sort()}),i(()=>{if(!y.value)return[];const t=y.value.map(e=>e.cardDetails.rarity);return[...new Set(t)].sort()});const V=i(()=>!o.value||!o.value.userCards||o.value.userCards.length===0?[]:o.value.userCards.filter(t=>{if(!t||!t.card)return!1;const e=t.card.name&&t.card.name.toLowerCase().includes(D.value.toLowerCase()),d=!g.value||t.card.type&&t.card.type.toLowerCase().includes(g.value.toLowerCase()),c=!b.value||t.card.rarity&&t.card.rarity.toLowerCase()===b.value.toLowerCase(),s=!C.value||t.card.colors&&t.card.colors.includes(C.value);return e&&d&&c&&s})),y=i(()=>{if(!o.value||!o.value.userCards)return T.userCards||[];const t=T.userCards||[],e=o.value.userCards.map(d=>d.id);return t.filter(d=>!e.includes(d.id))});i(()=>y.value?y.value.filter(t=>{const e=t.cardDetails.name.toLowerCase().includes(q.value.toLowerCase()),d=!F.value||t.cardDetails.type.toLowerCase().includes(F.value.toLowerCase()),c=!H.value||t.cardDetails.rarity.toLowerCase()===H.value.toLowerCase(),s=!N.value||t.cardDetails.colors&&t.cardDetails.colors.includes(N.value);return e&&d&&c&&s}):[]);const Z=async()=>{var t;!U.value||!p.value||(await u.fetchDeck(p.value),(t=A.value)!=null&&t.id&&await T.fetchUserCards(A.value.id))},ee=async t=>{if(p.value)try{if(await u.addUserCardToDeck(p.value,t)){if(await u.fetchDeck(p.value),!u.currentDeck||!u.currentDeck.userCards){console.error("Received invalid deck data after fetch");return}}else console.error("Failed to add card to deck: No deck data returned")}catch(e){console.error("Error adding card to deck:",e)}},te=async t=>{if(p.value&&confirm("Are you sure you want to remove this card from the deck?"))try{await u.removeUserCardFromDeck(p.value,t),await u.fetchDeck(p.value)}catch(e){console.error("Error removing card from deck:",e)}},E=()=>{D.value="",g.value="",b.value="",C.value=""},re=t=>{const e=M.find(d=>d.code===t);return e?e.class:"bg-gray-300"},se=t=>{const e=M.find(d=>d.code===t);return e?e.name:"Unknown"};function oe(){let t="";for(const e of o.value.userCards)t+=e.card.name+=`
`;navigator.clipboard.writeText(t),document.getElementById("copyDeckListBtn").innerText="Copied!",setTimeout(()=>{document.getElementById("copyDeckListBtn").innerText="Copy Decklist"},2e3)}const ae=t=>{t.action==="Add To Deck"&&ee(t.card.id)};return ie(async()=>{await I.initAuth(),await Z()}),(t,e)=>{var c;const d=ne;return n(),l("div",null,[L(ke,{title:o.value?o.value.name:"Deck Details",subtitle:o.value?o.value.description:"Loading..."},null,8,["title","subtitle"]),k(U)?k(u).loading?(n(),l("div",De,e[9]||(e[9]=[r("p",null,"Loading deck...",-1)]))):k(u).error?(n(),l("div",_e,[r("p",null,m(k(u).error),1)])):o.value?(n(),l("div",Le,[r("div",Se,[e[12]||(e[12]=r("h2",{class:"text-2xl font-bold"},"Deck Overview",-1)),r("button",{id:"copyDeckListBtn",onClick:e[0]||(e[0]=s=>oe()),class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"}," Copy Decklist ")]),r("div",Te,[r("div",{id:"deckList",innerHTML:Y.value},null,8,Ae)]),r("div",Me,[e[13]||(e[13]=r("h2",{class:"text-2xl font-bold"},"Cards in this Deck",-1)),r("button",{onClick:e[1]||(e[1]=s=>h.value=!0),class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"}," Add Cards ")]),r("div",Re,[r("div",Be,[e[14]||(e[14]=r("label",{class:"block text-gray-700 mb-2",for:"search"},"Search Cards",-1)),S(r("input",{id:"search","onUpdate:modelValue":e[2]||(e[2]=s=>D.value=s),type:"text",placeholder:"Search by card name...",class:"w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[pe,D.value]])]),r("div",Ie,[r("div",null,[e[16]||(e[16]=r("label",{class:"block text-gray-700 mb-2",for:"type"},"Type",-1)),S(r("select",{id:"type","onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s),class:"w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[15]||(e[15]=r("option",{value:""},"All Types",-1)),(n(!0),l(x,null,w(J.value,s=>(n(),l("option",{key:s,value:s},m(s),9,Ue))),128))],512),[[B,g.value]])]),r("div",null,[e[18]||(e[18]=r("label",{class:"block text-gray-700 mb-2",for:"rarity"},"Rarity",-1)),S(r("select",{id:"rarity","onUpdate:modelValue":e[4]||(e[4]=s=>b.value=s),class:"w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[17]||(e[17]=r("option",{value:""},"All Rarities",-1)),(n(!0),l(x,null,w(K.value,s=>(n(),l("option",{key:s,value:s},m(s),9,Fe))),128))],512),[[B,b.value]])]),r("div",null,[e[20]||(e[20]=r("label",{class:"block text-gray-700 mb-2",for:"color"},"Color",-1)),S(r("select",{id:"color","onUpdate:modelValue":e[5]||(e[5]=s=>C.value=s),class:"w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[19]||(e[19]=r("option",{value:""},"All Colors",-1)),(n(!0),l(x,null,w(X.value,s=>(n(),l("option",{key:s.code,value:s.code},m(s.name),9,He))),128))],512),[[B,C.value]])]),r("div",{class:"flex items-end"},[r("button",{onClick:E,class:"w-full px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition"}," Reset Filters ")])])]),V.value.length>0?(n(),l("div",Ne,[(n(!0),l(x,null,w(V.value,s=>(n(),l("div",{key:s.id,class:"bg-white shadow rounded p-4 flex justify-between"},[r("div",null,[r("h3",Ve,m(s.card.name),1),r("p",Ee,m(s.card.type)+" â€¢ "+m(s.card.rarity),1),r("div",je,[(n(!0),l(x,null,w(s.card.colors,(f,_)=>(n(),l("span",{key:_,class:ge(["w-5 h-5 rounded-full",re(f)]),title:se(f)},null,10,Pe))),128))]),r("div",ze,[r("img",{src:`${s.card.imageUrl}`,alt:`Card ${s.multiverseId||s.cardDetails&&s.cardDetails.multiverseId}`,class:"w-40"},null,8,Ge)]),r("div",Oe,m(`${s.card.text}`),1)]),r("button",{onClick:f=>te(s.id),class:"h-8 px-4 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition"}," Remove ",8,Qe)]))),128))])):o.value.userCards&&o.value.userCards.length>0?(n(),l("div",We,[e[21]||(e[21]=r("p",{class:"text-gray-600"},"No cards match your search criteria.",-1)),r("button",{onClick:E,class:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition"}," Reset Filters ")])):(n(),l("div",qe,[e[22]||(e[22]=r("p",{class:"text-gray-600"},"This deck has no cards yet.",-1)),r("button",{onClick:e[6]||(e[6]=s=>h.value=!0),class:"mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"}," Add Your First Card ")]))])):(n(),l("div",$e,[e[11]||(e[11]=r("p",null,"Deck not found.",-1)),L(d,{to:"/decks",class:"mt-4 inline-block px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition"},{default:ve(()=>e[10]||(e[10]=[fe(" Back to Decks ")])),_:1})])):(n(),l("div",he,[e[8]||(e[8]=r("p",null,"Please log in to view deck details.",-1)),L(xe,{class:"mt-4"})])),h.value?(n(),l("div",Ye,[r("div",Je,[e[23]||(e[23]=r("h3",{class:"text-xl font-bold mb-4"},"Add Cards to Deck",-1)),r("div",Ke,[L(we,{userId:(c=k(A))==null?void 0:c.id,cardActions:["Add To Deck"],excludeCards:o.value.userCards,onOnClickAction:ae},null,8,["userId","excludeCards"])]),r("div",Xe,[r("button",{onClick:e[7]||(e[7]=s=>h.value=!1),class:"px-4 py-2 text-gray-600 hover:text-gray-800"}," Close ")])])])):ce("",!0)])}}};export{nt as default};
