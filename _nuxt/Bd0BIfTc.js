import{_ as H}from"./CNjZpCbW.js";import{e as Q,m as J,s as V,p as S,r as L,f as K,g as O,q as X,c as a,b as P,a as e,h as v,u as n,w as Y,t as l,n as Z,j as A,k as y,x as B,F as _,i as k,v as x,y as ee,o as r,d as se,z as te,_ as oe}from"./BLjF41zC.js";import{u as le}from"./BeV5hg_6.js";import{u as ne}from"./ChjthFXB.js";import{_ as ae}from"./BrHr5CZF.js";const re={class:"mt-4"},de={key:0,class:"text-center py-10"},ue={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mt-4"},ie={key:2,class:"mt-6 space-y-6"},ce={class:"bg-white p-6 rounded shadow-md"},me={class:"flex justify-between items-start"},be={class:"text-2xl font-bold text-gray-900"},pe={key:0,class:"text-gray-600 mt-1"},ge={class:"text-sm text-gray-500 mt-2"},ye={class:"bg-white p-6 rounded shadow-md"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ve=["value"],xe={class:"flex items-end"},we=["disabled"],he={class:"bg-white p-6 rounded shadow-md"},_e={class:"flex justify-between items-center mb-4"},ke={class:"flex gap-2"},Ue=["disabled"],Re={key:0,class:"overflow-x-auto"},Ie={class:"min-w-full bg-white"},Se={class:"py-3 px-4"},Ae={class:"flex items-center"},Ce={class:"font-semibold text-lg"},Te={key:0,class:"ml-2 text-yellow-500"},Ne={key:1,class:"ml-2 text-gray-400"},De={key:2,class:"ml-2 text-yellow-600"},Ve={class:"py-3 px-4"},Le={class:"flex items-center"},Pe=["src","alt"],Be={class:"font-medium"},$e={key:0,class:"text-sm text-gray-500"},qe={class:"py-3 px-4 text-center"},We={class:"font-semibold text-green-600"},je={class:"py-3 px-4 text-center"},Me={class:"font-semibold text-red-600"},Ee={class:"py-3 px-4 text-center"},Fe={class:"text-gray-600"},ze={class:"py-3 px-4 text-center"},Ge={class:"flex items-center justify-center"},He={class:"w-16 bg-gray-200 rounded-full h-2 mr-2"},Qe={class:"font-medium"},Je={class:"py-3 px-4 text-center"},Ke=["onClick"],Oe={key:1,class:"text-center py-8"},Xe={class:"bg-white p-6 rounded shadow-md"},Ye={class:"space-y-3"},Ze=["onUpdate:modelValue"],es=["value"],ss=["onUpdate:modelValue"],ts=["onUpdate:modelValue"],os={class:"flex items-end"},ls=["onClick"],ns={class:"flex justify-between"},as=["disabled"],rs={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},ds={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},us={class:"text-lg font-bold text-gray-900 mb-4"},is={class:"flex justify-end space-x-2"},cs=["disabled"],ms=Q({__name:"[id]",setup(bs){const b=J().params.id,C=le(),f=ne(),{users:U}=V(C),{currentTournament:c,standings:T,loading:m,error:R}=V(f),w=S(()=>{var o;return((o=T.value)==null?void 0:o.standings)||[]}),u=L(null),d=K({userId:"",wins:0,losses:0}),p=L([{userId:"",wins:0,losses:0},{userId:"",wins:0,losses:0},{userId:"",wins:0,losses:0}]),N=S(()=>U.value.filter(o=>o.username)),$=S(()=>p.value.some(o=>o.userId&&(o.wins>0||o.losses>0))),D=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),h=async()=>{await f.fetchTournamentStandings(b)},q=async()=>{if(console.log("Starting single result update..."),console.log("quickResult data:",d),console.log("tournamentId:",b),!d.userId){alert("Please select a user");return}if(d.wins<0||d.losses<0){alert("Wins and losses must be non-negative");return}const o=await f.updateTournamentResult(b,{userId:d.userId,wins:d.wins,losses:d.losses});console.log("Update result success:",o),o&&(d.userId="",d.wins=0,d.losses=0,console.log("Form reset after successful update"),await h())},W=o=>{u.value={...o,originalWins:o.wins,originalLosses:o.losses}},j=async()=>{if(!u.value)return;await f.updateTournamentResult(b,{userId:u.value.user.id,wins:u.value.wins,losses:u.value.losses})&&(u.value=null,await h())},M=()=>{p.value.push({userId:"",wins:0,losses:0})},E=o=>{p.value.length>1&&p.value.splice(o,1)},F=async()=>{console.log("Starting bulk update..."),console.log("bulkResults data:",p.value);const o=p.value.filter(g=>g.userId&&(g.wins>0||g.losses>0));if(console.log("Valid results:",o),o.length===0){alert("Please select at least one user and enter wins/losses.");return}const s=await f.bulkUpdateResults(b,o);console.log("Bulk update success:",s),s&&(p.value=[{userId:"",wins:0,losses:0},{userId:"",wins:0,losses:0},{userId:"",wins:0,losses:0}],console.log("Bulk form reset after successful update"),await h())};O(async()=>{await Promise.all([C.fetchAllUsers(),f.fetchTournamentStandings(b)])});const z=async()=>{var o;console.log("Testing direct API call...");try{const{fetch:s}=ee(),g={userId:(o=U.value[0])==null?void 0:o.id,wins:1,losses:0};console.log("Test data:",g),console.log("Tournament ID:",b);const t=await s(`/tournaments/${b}/results/user`,{method:"PATCH",body:g});console.log("Direct API call successful:",t)}catch(s){console.error("Direct API call failed:",s)}};window.testDirectApiCall=z;const G=()=>{console.log("=== DEBUG STANDINGS ==="),console.log("Tournament:",c.value),console.log("Raw standings from store:",T.value),console.log("Current standings computed:",w.value),console.log("Users:",U.value),console.log("Loading:",m.value),console.log("Error:",R.value),console.log("======================")};return X(()=>{f.clearCurrentTournament()}),(o,s)=>{const g=H;return r(),a("div",null,[P(ae,{title:n(c)?`${n(c).name} - Results`:"Tournament Management",subtitle:n(c)?`Manage wins and losses for ${D(n(c).date)}`:"Loading tournament..."},null,8,["title","subtitle"]),e("div",re,[P(g,{to:"/admin",class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},{default:Y(()=>s[6]||(s[6]=[se(" ← Back to Admin Dashboard ")])),_:1})]),n(m)?(r(),a("div",de,s[7]||(s[7]=[e("p",null,"Loading tournament data...",-1)]))):n(R)?(r(),a("div",ue,l(n(R)),1)):n(c)?(r(),a("div",ie,[e("div",ce,[e("div",me,[e("div",null,[e("h2",be,l(n(c).name),1),n(c).description?(r(),a("p",pe,l(n(c).description),1)):v("",!0),e("p",ge,l(D(n(c).date)),1)]),e("span",{class:Z(["px-3 py-1 rounded-full text-sm font-medium",n(c).isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},l(n(c).isActive?"Active":"Inactive"),3)])]),e("div",ye,[s[12]||(s[12]=e("h3",{class:"text-lg font-semibold mb-4"},"Quick Add/Update Result",-1)),e("form",{onSubmit:A(q,["prevent"]),class:"space-y-4"},[e("div",fe,[e("div",null,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-gray-700"},"User",-1)),y(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>d.userId=t),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[s[8]||(s[8]=e("option",{value:""},"Select a user",-1)),(r(!0),a(_,null,k(N.value,t=>(r(),a("option",{key:t.id,value:t.id},l(t.firstName)+" "+l(t.lastName)+" "+l(t.username?`(${t.username})`:""),9,ve))),128))],512),[[B,d.userId]])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-gray-700"},"Wins",-1)),y(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>d.wins=t),type:"number",min:"0",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[x,d.wins,void 0,{number:!0}]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-gray-700"},"Losses",-1)),y(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>d.losses=t),type:"number",min:"0",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[x,d.losses,void 0,{number:!0}]])]),e("div",xe,[e("button",{type:"submit",disabled:n(m),class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},l(n(m)?"Updating...":"Update Result"),9,we)])])],32)]),e("div",he,[e("div",_e,[s[13]||(s[13]=e("h3",{class:"text-lg font-semibold"},"Current Standings",-1)),e("div",ke,[e("button",{onClick:G,class:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded text-sm"}," Debug Data "),e("button",{onClick:h,disabled:n(m),class:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded text-sm disabled:opacity-50"},l(n(m)?"Refreshing...":"Refresh"),9,Ue)])]),w.value&&w.value.length>0?(r(),a("div",Re,[e("table",Ie,[s[14]||(s[14]=e("thead",null,[e("tr",{class:"border-b"},[e("th",{class:"py-3 px-4 text-left"},"Rank"),e("th",{class:"py-3 px-4 text-left"},"Player"),e("th",{class:"py-3 px-4 text-center"},"Wins"),e("th",{class:"py-3 px-4 text-center"},"Losses"),e("th",{class:"py-3 px-4 text-center"},"Total Games"),e("th",{class:"py-3 px-4 text-center"},"Win Rate"),e("th",{class:"py-3 px-4 text-center"},"Actions")])],-1)),e("tbody",null,[(r(!0),a(_,null,k(w.value,t=>(r(),a("tr",{key:t.user.id,class:"border-b hover:bg-gray-50"},[e("td",Se,[e("div",Ae,[e("span",Ce,"#"+l(t.rank),1),t.rank===1?(r(),a("span",Te,"🏆")):t.rank===2?(r(),a("span",Ne,"🥈")):t.rank===3?(r(),a("span",De,"🥉")):v("",!0)])]),e("td",Ve,[e("div",Le,[t.user.picture?(r(),a("img",{key:0,src:t.user.picture,alt:t.user.firstName,class:"h-8 w-8 rounded-full mr-3"},null,8,Pe)):v("",!0),e("div",null,[e("div",Be,l(t.user.firstName)+" "+l(t.user.lastName),1),t.user.username?(r(),a("div",$e,"@"+l(t.user.username),1)):v("",!0)])])]),e("td",qe,[e("span",We,l(t.wins),1)]),e("td",je,[e("span",Me,l(t.losses),1)]),e("td",Ee,[e("span",Fe,l(t.totalGames),1)]),e("td",ze,[e("div",Ge,[e("div",He,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:te({width:t.winRate*100+"%"})},null,4)]),e("span",Qe,l((t.winRate*100).toFixed(1))+"%",1)])]),e("td",Je,[e("button",{onClick:I=>W(t),class:"bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-1 px-3 rounded text-sm"}," Edit ",8,Ke)])]))),128))])])])):(r(),a("div",Oe,s[15]||(s[15]=[e("p",{class:"text-gray-500"},"No results recorded yet. Add some results using the form above!",-1)])))]),e("div",Xe,[s[20]||(s[20]=e("h3",{class:"text-lg font-semibold mb-4"},"Bulk Update Results",-1)),s[21]||(s[21]=e("p",{class:"text-sm text-gray-600 mb-4"}," Update multiple players' results at once. Leave wins/losses as 0 if you don't want to change them. ",-1)),e("form",{onSubmit:A(F,["prevent"]),class:"space-y-4"},[e("div",Ye,[(r(!0),a(_,null,k(p.value,(t,I)=>(r(),a("div",{key:I,class:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 border rounded"},[e("div",null,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium text-gray-700"},"User",-1)),y(e("select",{"onUpdate:modelValue":i=>t.userId=i,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[s[16]||(s[16]=e("option",{value:""},"Select a user",-1)),(r(!0),a(_,null,k(N.value,i=>(r(),a("option",{key:i.id,value:i.id},l(i.firstName)+" "+l(i.lastName)+" "+l(i.username?`(${i.username})`:""),9,es))),128))],8,Ze),[[B,t.userId]])]),e("div",null,[s[18]||(s[18]=e("label",{class:"block text-sm font-medium text-gray-700"},"Wins",-1)),y(e("input",{"onUpdate:modelValue":i=>t.wins=i,type:"number",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,8,ss),[[x,t.wins,void 0,{number:!0}]])]),e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700"},"Losses",-1)),y(e("input",{"onUpdate:modelValue":i=>t.losses=i,type:"number",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,8,ts),[[x,t.losses,void 0,{number:!0}]])]),e("div",os,[e("button",{type:"button",onClick:i=>E(I),class:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded text-sm"}," Remove ",8,ls)])]))),128))]),e("div",ns,[e("button",{type:"button",onClick:M,class:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"}," Add Another Player "),e("button",{type:"submit",disabled:n(m)||!$.value,class:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},l(n(m)?"Updating...":"Update All Results"),9,as)])],32)])])):v("",!0),u.value?(r(),a("div",rs,[e("div",ds,[e("h3",us," Edit Results for "+l(u.value.user.firstName)+" "+l(u.value.user.lastName),1),e("form",{onSubmit:A(j,["prevent"]),class:"space-y-4"},[e("div",null,[s[22]||(s[22]=e("label",{class:"block text-sm font-medium text-gray-700"},"Wins",-1)),y(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>u.value.wins=t),type:"number",min:"0",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[x,u.value.wins,void 0,{number:!0}]])]),e("div",null,[s[23]||(s[23]=e("label",{class:"block text-sm font-medium text-gray-700"},"Losses",-1)),y(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>u.value.losses=t),type:"number",min:"0",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[x,u.value.losses,void 0,{number:!0}]])]),e("div",is,[e("button",{type:"button",onClick:s[5]||(s[5]=t=>u.value=null),class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"}," Cancel "),e("button",{type:"submit",disabled:n(m),class:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},l(n(m)?"Updating...":"Update Result"),9,cs)])],32)])])):v("",!0)])}}}),ws=oe(ms,[["__scopeId","data-v-6e29022e"]]);export{ws as default};
