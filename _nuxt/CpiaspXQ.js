import{_ as z}from"./PBuPW5p8.js";import{_ as G}from"./D-J88W1f.js";import{l as H,n as x,m as A,j as J,E as K,c as s,a as e,p as h,D as c,k as v,t as i,q as L,v as I,F as p,r as y,b as w,d as B,w as Q,B as W,o as r}from"./BCB1vQZ2.js";import{u as X}from"./CfbvoOLI.js";import{u as Z}from"./BMpmId6l.js";const ee={class:"bg-white shadow rounded-lg p-6"},te={class:"mb-10"},se={class:"flex items-center"},re={class:"flex items-center relative"},oe={class:"flex items-center relative"},le={class:"flex items-center relative"},de={key:0,class:"mb-6"},ae={key:0,class:"flex justify-center my-10"},ne={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6"},ie={key:2},ue={class:"mb-4"},ce={class:"mt-6"},ve={key:0,class:"text-center py-6 bg-gray-50 rounded-lg"},me={key:1,class:"grid grid-cols-1 md:grid-cols-3 gap-4 max-h-96 overflow-y-auto p-2"},be=["onClick"],ge={class:"flex items-center"},xe={class:"bg-gray-200 rounded-full h-10 w-10 flex items-center justify-center text-gray-600 mr-3"},fe={class:"font-medium"},pe={class:"text-xs text-gray-500"},ye={key:1},he={class:"mb-4 flex justify-between items-center"},_e={class:"text-sm text-gray-600"},we={key:0,class:"mb-6"},ke={class:"flex flex-wrap gap-2"},Ce={class:"text-sm mr-2"},Se=["onClick"],Te={key:2},Ue={class:"mb-4 flex justify-between items-center"},je={class:"text-sm text-gray-600"},Ne={key:0,class:"mb-6"},Ae={class:"flex flex-wrap gap-2"},Le={class:"text-sm mr-2"},Ie=["onClick"],Be={key:3},Ee={class:"mb-6"},Re={class:"bg-gray-50 p-4 rounded-lg"},Me={class:"mb-2"},Ve={class:"font-medium"},Ye={class:"grid md:grid-cols-2 gap-6 mb-6"},De={key:0,class:"text-center p-6 bg-gray-50 rounded-lg"},$e={key:1,class:"border rounded-lg p-4 bg-gray-50"},qe={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Oe={class:"text-sm"},Pe={key:0,class:"text-center p-6 bg-gray-50 rounded-lg"},Fe={key:1,class:"border rounded-lg p-4 bg-gray-50"},ze={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Ge={class:"text-sm"},He={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6"},Je={class:"mb-6"},Ke={class:"flex justify-between pt-4 border-t"},Qe={key:1},We={class:"flex space-x-3"},Xe=["disabled"],Ze=["disabled"],et={key:0},tt={key:1},nt={__name:"create",setup(st){const E=W(),m=X(),g=Z(),k=H(),l=x(1),b=x(null),_=x(""),a=x([]),n=x([]),C=x(""),S=A(()=>g.publicUsernames?g.publicUsernames.filter(d=>{var t;return d.id!==((t=k.user)==null?void 0:t.id)&&d.username.toLowerCase().includes(_.value.toLowerCase())}):[]),R=A(()=>l.value===1?b.value!==null:(l.value===2||l.value===3,!0));J(async()=>{g.publicUsernames.length||await g.fetchAllUsernames()}),K(l,()=>{m.resetCreateTradeState()});const M=d=>{b.value=d},f=d=>d.substring(0,8)+"...",V=({action:d,card:t})=>{d==="trade"&&(a.value.some(u=>u.id===t.id)||a.value.push(t))},Y=({action:d,card:t})=>{d==="trade"&&(n.value.some(u=>u.id===t.id)||n.value.push(t))},D=d=>{a.value=a.value.filter(t=>t.id!==d.id)},$=d=>{n.value=n.value.filter(t=>t.id!==d.id)},q=()=>{l.value<4&&l.value++},O=()=>{l.value>1&&l.value--},P=async()=>{if(!b.value||a.value.length===0&&n.value.length===0)return;const d={receiverId:b.value.id,initiatorCardIds:a.value.map(u=>u.id),receiverCardIds:n.value.map(u=>u.id)},t=await m.createTrade(d);t&&E.push(`/trades/${t.id}`)};return(d,t)=>{var T,U,j;const u=z,F=G;return r(),s("div",ee,[t[22]||(t[22]=e("h1",{class:"text-2xl font-bold mb-2"},"Create New Trade",-1)),t[23]||(t[23]=e("p",{class:"text-gray-600 mb-6"},"Exchange cards with another user",-1)),e("div",te,[e("div",se,[t[3]||(t[3]=e("div",{class:"flex items-center relative"},[e("div",{class:"rounded-full h-8 w-8 flex items-center justify-center bg-blue-500 text-white"},"1"),e("div",{class:"absolute top-0 -ml-4 text-xs font-medium text-blue-500 mt-10 w-16 text-center"}," Select Partner ")],-1)),e("div",{class:c(["flex-auto border-t-2",l.value>1?"border-blue-500":"border-gray-300"])},null,2),e("div",re,[e("div",{class:c(["rounded-full h-8 w-8 flex items-center justify-center",l.value>1?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"])},"2",2),e("div",{class:c(["absolute top-0 -ml-4 text-xs font-medium mt-10 w-16 text-center",l.value>1?"text-blue-500":"text-gray-500"])}," Your Cards ",2)]),e("div",{class:c(["flex-auto border-t-2",l.value>2?"border-blue-500":"border-gray-300"])},null,2),e("div",oe,[e("div",{class:c(["rounded-full h-8 w-8 flex items-center justify-center",l.value>2?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"])},"3",2),e("div",{class:c(["absolute top-0 -ml-4 text-xs font-medium mt-10 w-16 text-center",l.value>2?"text-blue-500":"text-gray-500"])}," Their Cards ",2)]),e("div",{class:c(["flex-auto border-t-2",l.value>3?"border-blue-500":"border-gray-300"])},null,2),e("div",le,[e("div",{class:c(["rounded-full h-8 w-8 flex items-center justify-center",l.value>3?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"])},"4",2),e("div",{class:c(["absolute top-0 -ml-4 text-xs font-medium mt-10 w-16 text-center",l.value>3?"text-blue-500":"text-gray-500"])}," Review ",2)])])]),t[24]||(t[24]=e("br",null,null,-1)),l.value===1?(r(),s("div",de,[v(g).usernamesLoading?(r(),s("div",ae,t[4]||(t[4]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"},null,-1)]))):v(g).usernamesError?(r(),s("div",ne,[e("p",null,i(v(g).usernamesError),1)])):(r(),s("div",ie,[e("div",ue,[t[5]||(t[5]=e("label",{for:"searchUser",class:"block text-sm font-medium text-gray-700"},"Search for a user",-1)),L(e("input",{id:"searchUser","onUpdate:modelValue":t[0]||(t[0]=o=>_.value=o),type:"text",placeholder:"Type username to search",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[I,_.value]])]),e("div",ce,[t[7]||(t[7]=e("h3",{class:"text-md font-medium mb-3"},"Select a user to trade with:",-1)),S.value.length===0?(r(),s("div",ve,t[6]||(t[6]=[e("p",{class:"text-gray-500"},"No users found matching your search criteria.",-1)]))):(r(),s("div",me,[(r(!0),s(p,null,y(S.value,o=>(r(),s("div",{key:o.id,onClick:N=>M(o),class:c(["border rounded-lg p-4 cursor-pointer hover:bg-blue-50 transition",b.value&&b.value.id===o.id?"border-blue-500 bg-blue-50":""])},[e("div",ge,[e("div",xe,i(o.username.charAt(0).toUpperCase()),1),e("div",null,[e("p",fe,i(o.username),1),e("p",pe,"User ID: "+i(f(o.id)),1)])])],10,be))),128))]))])]))])):l.value===2?(r(),s("div",ye,[e("div",he,[t[8]||(t[8]=e("h2",{class:"text-lg font-semibold"},"Select Cards to Offer",-1)),e("div",null,[e("span",_e,"Selected: "+i(a.value.length),1)])]),a.value.length>0?(r(),s("div",we,[t[10]||(t[10]=e("h3",{class:"font-medium mb-2"},"Selected Cards",-1)),e("div",ke,[(r(!0),s(p,null,y(a.value,o=>(r(),s("div",{key:o.id,class:"bg-blue-50 border border-blue-200 rounded px-3 py-1 flex items-center"},[e("span",Ce,i(f(o.id)),1),e("button",{onClick:N=>D(o),class:"text-red-500 hover:text-red-700"},t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Se)]))),128))])])):h("",!0),w(u,{userId:(T=v(k).user)==null?void 0:T.id,cardActions:["trade"],excludeCards:a.value,onOnClickAction:V},null,8,["userId","excludeCards"])])):l.value===3?(r(),s("div",Te,[e("div",Ue,[t[11]||(t[11]=e("h2",{class:"text-lg font-semibold"},"Select Cards to Request",-1)),e("div",null,[e("span",je,"Selected: "+i(n.value.length),1)])]),n.value.length>0?(r(),s("div",Ne,[t[13]||(t[13]=e("h3",{class:"font-medium mb-2"},"Selected Cards",-1)),e("div",Ae,[(r(!0),s(p,null,y(n.value,o=>(r(),s("div",{key:o.id,class:"bg-blue-50 border border-blue-200 rounded px-3 py-1 flex items-center"},[e("span",Le,i(f(o.id)),1),e("button",{onClick:N=>$(o),class:"text-red-500 hover:text-red-700"},t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ie)]))),128))])])):h("",!0),w(u,{userName:(U=b.value)==null?void 0:U.username,cardActions:["trade"],excludeCards:n.value,onOnClickAction:Y},null,8,["userName","excludeCards"])])):l.value===4?(r(),s("div",Be,[e("div",Ee,[t[15]||(t[15]=e("h2",{class:"text-lg font-semibold mb-4"},"Review Your Trade",-1)),e("div",Re,[e("p",Me,[t[14]||(t[14]=B(" Trading with: ")),e("span",Ve,i((j=b.value)==null?void 0:j.username),1)])])]),e("div",Ye,[e("div",null,[t[17]||(t[17]=e("h3",{class:"font-medium text-gray-700 mb-3"},"Your Offered Cards",-1)),a.value.length===0?(r(),s("div",De,t[16]||(t[16]=[e("p",{class:"text-gray-500"},"You aren't offering any cards",-1)]))):(r(),s("div",$e,[e("div",qe,[(r(!0),s(p,null,y(a.value,o=>(r(),s("div",{key:o.id,class:"border rounded p-2 bg-white"},[e("div",Oe,i(f(o.id)),1)]))),128))])]))]),e("div",null,[t[19]||(t[19]=e("h3",{class:"font-medium text-gray-700 mb-3"},"Cards You're Requesting",-1)),n.value.length===0?(r(),s("div",Pe,t[18]||(t[18]=[e("p",{class:"text-gray-500"},"You aren't requesting any cards",-1)]))):(r(),s("div",Fe,[e("div",ze,[(r(!0),s(p,null,y(n.value,o=>(r(),s("div",{key:o.id,class:"border rounded p-2 bg-white"},[e("div",Ge,i(f(o.id)),1)]))),128))])]))])]),v(m).createTradeError?(r(),s("div",He,[e("p",null,i(v(m).createTradeError),1),e("button",{onClick:t[1]||(t[1]=(...o)=>v(m).resetCreateTradeState&&v(m).resetCreateTradeState(...o)),class:"text-sm underline"},"Dismiss")])):h("",!0),e("div",Je,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Trade Notes (optional)",-1)),L(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=o=>C.value=o),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Add any comments or notes about this trade..."},null,512),[[I,C.value]])])])):h("",!0),e("div",Ke,[l.value>1?(r(),s("button",{key:0,onClick:O,class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition"}," Back ")):(r(),s("div",Qe)),e("div",We,[w(F,{to:"/trades",class:"px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50 transition"},{default:Q(()=>t[21]||(t[21]=[B(" Cancel ")])),_:1}),l.value<4?(r(),s("button",{key:0,onClick:q,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition",disabled:!R.value}," Next ",8,Xe)):(r(),s("button",{key:1,onClick:P,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition",disabled:v(m).createTradeLoading||!(a.value.length>0||n.value.length>0)},[v(m).createTradeLoading?(r(),s("span",et,"Creating...")):(r(),s("span",tt,"Create Trade"))],8,Ze))])])])}}};export{nt as default};
