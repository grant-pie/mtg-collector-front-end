import{_ as D}from"./CNjZpCbW.js";import{H as T,A as p,C as A,e as E,r as L,g as N,q as S,c,o as s,a as r,h as l,u as n,t as y,F as U,i as F,n as q,j as R,_ as z,D as H,s as P,b as M,w as _,d as g,G as f,a3 as V}from"./BLjF41zC.js";import{_ as G}from"./DID_Hutk.js";const j=T("notification",{state:()=>({notifications:[],unreadCount:0,loading:!1,error:null,markAsReadLoading:!1,markAsReadError:null}),getters:{unreadNotifications(){return this.notifications.filter(o=>!o.read)},readNotifications(){return this.notifications.filter(o=>o.read)},sortedNotifications(){return[...this.notifications].sort((o,t)=>o.read!==t.read?o.read?1:-1:new Date(t.createdAt).getTime()-new Date(o.createdAt).getTime())}},actions:{async fetchNotifications(){var t;const o=p();if(!o.token){this.error="Authentication required";return}this.loading=!0,this.error=null;try{const e=A(),i=await $fetch(`${e.public.apiBaseUrl}/notifications/my`,{headers:{Authorization:`Bearer ${o.token}`}});this.notifications=i}catch(e){console.error("Error fetching notifications:",e),this.error="Failed to load notifications",((t=e==null?void 0:e.response)==null?void 0:t.status)===401&&o.logout()}finally{this.loading=!1}},async fetchUnreadCount(){var t;const o=p();if(o.token)try{const e=A(),i=await $fetch(`${e.public.apiBaseUrl}/notifications/my/count`,{headers:{Authorization:`Bearer ${o.token}`}});this.unreadCount=i.count}catch(e){console.error("Error fetching unread count:",e),((t=e==null?void 0:e.response)==null?void 0:t.status)===401&&o.logout()}},async markAsRead(o){const t=p();if(!t.token)return this.markAsReadError="Authentication required",!1;this.markAsReadLoading=!0,this.markAsReadError=null;try{const e=A();await $fetch(`${e.public.apiBaseUrl}/notifications/${o}/read`,{method:"PATCH",headers:{Authorization:`Bearer ${t.token}`}});const i=this.notifications.find(h=>h.id===o);return i&&(i.read=!0),this.unreadCount=Math.max(0,this.unreadCount-1),!0}catch(e){return console.error("Error marking notification as read:",e),this.markAsReadError="Failed to mark notification as read",!1}finally{this.markAsReadLoading=!1}},async markAllAsRead(){const o=p();if(!o.token)return this.markAsReadError="Authentication required",!1;this.markAsReadLoading=!0,this.markAsReadError=null;try{const t=A();return await $fetch(`${t.public.apiBaseUrl}/notifications/my/read-all`,{method:"PATCH",headers:{Authorization:`Bearer ${o.token}`}}),this.notifications.forEach(e=>{e.read=!0}),this.unreadCount=0,!0}catch(t){return console.error("Error marking all notifications as read:",t),this.markAsReadError="Failed to mark all notifications as read",!1}finally{this.markAsReadLoading=!1}},async deleteNotification(o){const t=p();if(!t.token)return this.error="Authentication required",!1;try{const e=A();await $fetch(`${e.public.apiBaseUrl}/notifications/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.token}`}});const i=this.notifications.findIndex(h=>h.id===o);if(i!==-1){const h=!this.notifications[i].read;this.notifications.splice(i,1),h&&(this.unreadCount=Math.max(0,this.unreadCount-1))}return!0}catch(e){return console.error("Error deleting notification:",e),this.error="Failed to delete notification",!1}},addNotification(o){this.notifications.unshift(o),o.read||this.unreadCount++,this.notifications=[...this.notifications].sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},clearNotifications(){this.notifications=[],this.unreadCount=0,this.error=null}}}),I={class:"notification-bell"},O={key:0,class:"badge"},J={key:0,class:"notification-dropdown"},Y={class:"notification-header"},K=["disabled"],Q={key:0,class:"notification-loading"},W={key:1,class:"notification-error"},X={key:2,class:"no-notifications"},Z={key:3,class:"notification-list"},tt=["onClick"],et={class:"notification-title"},ot={class:"notification-message"},st={class:"notification-time"},it={class:"notification-actions"},at=["onClick"],nt=["onClick"],rt=E({__name:"NotificationBell",setup(o){const t=j(),e=L(!1);N(async()=>{await t.fetchNotifications(),await t.fetchUnreadCount()});const i=u=>{const m=document.querySelector(".notification-bell");m&&!m.contains(u.target)&&(e.value=!1)};N(()=>{document.addEventListener("click",i)}),S(()=>{document.removeEventListener("click",i)});const h=()=>{e.value=!e.value,e.value&&t.fetchNotifications()},x=u=>{const m=new Date(u),b=new Date().getTime()-m.getTime(),v=Math.floor(b/6e4),w=Math.floor(v/60),$=Math.floor(w/24);return v<60?v===0?"Just now":`${v}m ago`:w<24?`${w}h ago`:$<7?`${$}d ago`:m.toLocaleDateString()},C=async u=>{await t.markAsRead(u)},a=async()=>{await t.markAllAsRead()},d=async u=>{u.read||await t.markAsRead(u.id),u.type},B=async u=>{await t.deleteNotification(u)};return(u,m)=>(s(),c("div",I,[r("button",{onClick:h,class:"bell-button"},[m[0]||(m[0]=r("span",{class:"icon"},"ðŸ””",-1)),n(t).unreadCount>0?(s(),c("span",O,y(n(t).unreadCount),1)):l("",!0)]),e.value?(s(),c("div",J,[r("div",Y,[m[1]||(m[1]=r("h3",null,"Notifications",-1)),n(t).unreadCount>0?(s(),c("button",{key:0,onClick:a,disabled:n(t).markAsReadLoading,class:"mark-read-button"}," Mark all as read ",8,K)):l("",!0)]),n(t).loading?(s(),c("div",Q," Loading... ")):n(t).error?(s(),c("div",W,y(n(t).error),1)):n(t).notifications.length===0?(s(),c("div",X," No notifications ")):(s(),c("ul",Z,[(s(!0),c(U,null,F(n(t).sortedNotifications,k=>(s(),c("li",{key:k.id,class:q([{unread:!k.read},"notification-item"])},[r("div",{class:"notification-content",onClick:b=>d(k)},[r("p",et,y(k.title),1),r("p",ot,y(k.message),1),r("p",st,y(x(k.createdAt)),1)],8,tt),r("div",it,[k.read?l("",!0):(s(),c("button",{key:0,onClick:R(b=>C(k.id),["stop"]),class:"mark-read-button"}," Mark as read ",8,at)),r("button",{onClick:R(b=>B(k.id),["stop"]),class:"delete-button"}," Delete ",8,nt)])],2))),128))]))])):l("",!0)]))}}),ct=z(rt,[["__scopeId","data-v-26e49a71"]]),lt={class:"bg-gray-800 text-white p-4"},dt={class:"container mx-auto flex justify-between items-center"},ut={class:"flex space-x-4 items-center"},ft=E({__name:"Navbar",setup(o){const t=H(),e=p(),{isAuthenticated:i,isAdmin:h}=P(e),x=async()=>{e.logout(),t.push("/")};return(C,a)=>{const d=D;return s(),c("nav",lt,[r("div",dt,[M(d,{to:"/",class:"text-xl font-bold"},{default:_(()=>a[0]||(a[0]=[g("MTG Collector")])),_:1}),r("div",ut,[n(i)?(s(),f(d,{key:0,to:"/rankings",class:"hover:text-blue-300"},{default:_(()=>a[1]||(a[1]=[g(" Rankings ")])),_:1})):l("",!0),n(i)?(s(),f(d,{key:1,to:"/players",class:"hover:text-blue-300"},{default:_(()=>a[2]||(a[2]=[g(" Players ")])),_:1})):l("",!0),n(i)?(s(),f(d,{key:2,to:"/marketplace",class:"hover:text-blue-300"},{default:_(()=>a[3]||(a[3]=[g(" Marketplace ")])),_:1})):l("",!0),n(i)?(s(),f(d,{key:3,to:"/profile",class:"hover:text-blue-300"},{default:_(()=>a[4]||(a[4]=[g(" Profile ")])),_:1})):l("",!0),n(i)?(s(),f(d,{key:4,to:"/cards",class:"hover:text-blue-300"},{default:_(()=>a[5]||(a[5]=[g(" My Cards ")])),_:1})):l("",!0),n(i)?(s(),f(d,{key:5,to:"/decks",class:"hover:text-blue-300"},{default:_(()=>a[6]||(a[6]=[g(" My Decks ")])),_:1})):l("",!0),n(i)?(s(),f(d,{key:6,to:"/trades",class:"hover:text-blue-300"},{default:_(()=>a[7]||(a[7]=[g(" My Trades ")])),_:1})):l("",!0),n(h)?(s(),f(d,{key:7,to:"/admin",class:"hover:text-blue-300"},{default:_(()=>a[8]||(a[8]=[g(" Admin ")])),_:1})):l("",!0),n(h)?(s(),f(d,{key:8,to:"/notifications",class:"hover:text-blue-300"},{default:_(()=>a[9]||(a[9]=[g(" Notifications ")])),_:1})):l("",!0),n(i)?(s(),f(ct,{key:9,class:"text-black"})):l("",!0),n(i)?(s(),c("button",{key:10,onClick:x,class:"bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded"}," Logout ")):(s(),f(G,{key:11}))])])])}}}),ht={class:"min-h-screen flex flex-col bg-gray-100"},mt={class:"container mx-auto px-4 py-8"},kt={class:"bg-gray-800 text-white p-4 mt-8 mt-auto"},_t={class:"container mx-auto text-center"},At={__name:"default",setup(o){return(t,e)=>(s(),c("div",ht,[M(ft),r("div",mt,[V(t.$slots,"default")]),r("footer",kt,[r("div",_t," Â© "+y(new Date().getFullYear())+" MTG Collector ",1)])]))}};export{At as default};
